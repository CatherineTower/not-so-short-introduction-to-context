%%% File:      b08_Lists.mkiv
%%% Author:    Joaquín Ataz-López
%%% Begun:     July 2020
%%% Concluded: July 2020
%%% Contents:  Initially this chapter was to be part of Chapter 12
%              (elements and structures of documents). But I saw that on
%              the one hand indexes affected the document globally, and on
%              the other hand, if I included this in Chapter 12, it would
%              become disproprotionately long. The chapter was written in
%              record time (three or four days), a sign that I was already
%              beginning to get a more intimate understanding of ConTeXt.
%
%%% Edited with: Emacs + AuTeX - And at times vim + context-plugin
%%%

\environment ../introCTX_env.mkiv

\startcomponent b08_Lists.mkiv

\startchapter
  [
    reference=cap:toc,
    title={Table of contents, indexes, lists},
    bookmark={Table of contents, indexes, lists},
  ]

\TocChap

A table of contents and an index are a global aspect of a document. Almost
all documents will have a table of contents, while, only some documents
will have an index. For many languages (but not for English) both the table
of contents and the index come under the general term \quote{index}. For
English readers, a table of contents will normally come at the beginning
(of a document, or possibly in some cases at the beginning of chapters as
well), and the index will come at the end.

Either of these imply a particular application of the mechanism for
internal references whose explanation is included in
\in{section}[sec:references].

\startsection
  [
    reference=sec:content,
    title=Table of contents,
  ]

\startsubsection
  [title=Overall view of the table of contents]

In the previous chapter we examined the commands that allow the structure
of a document to be established as it has been written. This section
focuses on the table of contents and the index, which in some way {\em
mirror} the document's structure. The table of contents is very useful for
getting an idea of the document as a whole (it helps contextualise
information) and for searching the exact point where a particular passage
might be located. Books with a very complex structure, with many sections
and subsections with various levels of depth, seem to require a different
kind of table of contents, since a poorly detailed one (perhaps with only
the first two or three levels of sectioning) helps a lot to get an overall
idea of the contents of the document, but is not very useful for locating a
particular passage; unlike a very detailed table of contents, on the other
hand, where it is easy to miss the forest for the trees and lose the
overall view of the document. This is why, sometimes, books with a
particularly complex structure include more than one table of contents: one
not too detailed at the beginning showing the main parts, and a more
detailed table of contents at the beginning of each chapter as well as,
perhaps, an index at the end.

These can all be generated by \ConTeXt\ automatically with relative ease.
We can:

\startitemize

  \item Generate a complete or partial table of contents at any point in
  the document.

  \item Decide on the contents of either.

  \item configure their appearance down to the last detail.

  \item Include hyperlinks in the table of contents that allow us to jump
  directly to the section in question.

\stopitemize

In fact this last utility is included by default in all tables of contents
provided that the interactivity function has been enabled in the document.
See, in this respect, \in{section}[sec:interactivity].

The explanation of this in the \ConTeXt\ reference manual is, in my
opinion, somewhat confusing, which I think is due to the fact that too much
information is introduced at once. The mechanism for building \ConTeXt\
tables of contents has many pieces to it; and it is difficult for a text
that tries to explain them all at once to be clear. Especially for the
reader who is new to the scene. By contrast, the explanation in
\goto{wiki}[(https://wiki.contextgarden.net/Table_of_Contents#Page_numbering_in_ToC)],
is practically limited to examples: very useful for learning {\em tricks}
but inadequate -- I think -- for understanding the mechanism and how it
works. this is why the strategy I have decided to use to explain things in
this introduction begins by assuming something that is not strictly true
(or not completely true): that there is something in \ConTeXt\ called the
{\em table of contents}. Starting with this, the {\em normal} commands for
generating the table of contents are explained, and when these commands and
their configuration are well known, I think this is the moment for
introducing -- though at a theoretical rather than more practical level --
the information on those pieces of the mechanism that have been omitted up
till then. Knowledge of these additional {\em pieces} allows us to create
much more customised tables of contents than the ones we can call the {\em
normal ones} created with the commands explained up to that point; however,
in most cases we will not need to do this.

\stopsubsection

\startsubsection
  [
    reference=sec:completecontent,
    title=Completely automatic table of contents with a title,
  ]

The basic commands for generating an automatically generated table of contents (TOC) from the numbered sections of a document ({\tt part}, {\tt chapter}, {\tt section}, etc.) are \PlaceMacro{completecontent}\tex{completecontent} and \PlaceMacro{placecontent}\tex{placecontent}. The main difference between the two commands is that the first adds a {\em title} to the TOC; to do so, immediately before the TOC it inserts an {\em unnumbered chapter} whose default title is Table of Contents.

Therefore \tex{completecontent}:

\startitemize

  \item Inserts, at the point where it is found, a new unnumbered chapter
  entitled \quotation{Table of Contents}.

  \startSmallPrint

    We recall that in \ConTeXt\ the command used to generate an unnumbered
    section at the same level as chapters, is \tex{title} (see
    \in{section}[sec:sectiontypes]). Therefore in reality
    \tex{completecontent} does not insert a {\em Chapter} (\tex{chapter})
    but a {\em Title} (\tex{title}). I have not said so because I think it
    may be confusing for the reader to use the names of the unnumbered
    section commands here, since the term {\em Title} also has a broader
    sense, and it is easy for the reader not to identify it with the
    concrete level of sectioning we are referring to.

  \stopSmallPrint

  \item This {\em chapter} (actually, \tex{title}) is formatted exactly the
  same as the rest of the unnumbered chapters in the document; which by
  default includes a page break.

  \item The table of contents is printed immediately after the title.

\stopitemize

Initially the generated TOC is {\em complete}, as we can deduce from the
command name that generates it (\tex{completecontent}). But on the one hand
we can limit the level of depth of the TOC as explained in
\in{section}[sec:placecontent] and, on the other, since this command is
{\em sensitive} to the place it is found in the source file (see what is
said further on about \tex{placecontent}), if \tex{completecontent} is not
found at the beginning of the document it is possible that the TOC
generated is not complete;  and in some points of the source file it is
even possible that the command is apparently ignored. If this happens, the
solution is to invoke the command with the \MyKey{criterium=all} option.
Regarding this option, also see \in{section}[sec:placecontent].

To change the default title assigned to the TOCs we use the
\PlaceMacro{setupheadtext}\tex{setupheadtext} command whose syntax is:

  \type{\setupheadtext[Language][Element=Name]}

where {\em Language} is optional and refers to the language identifier used
by \ConTeXt\ (see \in{section}[sec:langdoc]), and {\em Element} refers to
the element whose name we want to change (\MyKey{content} in the case of
the table of contents) and {\em Name} is the name or title we want to give
our TOC. For example

  \type{\setupheadtext[en][content=Contents]}

will ensure that the TOC generated by \tex{completecontent} is entitled
\quotation{Contents} instead of \quotation{Table of Contents}.

Moreover, \tex{completecontent} allows the same configuration options as
\tex{placecontent}, for the explanation of which I refer to (the next
section).

\stopsubsection

\startsubsection
  [
    reference=sec:placecontent,
    title=Automatic table of contents without a title,
  ]

The general command for inserting a TOC without a title, generated
automatically from the document's sectioning commands, is
\tex{placecontent}, whose syntax is:

\type{\placecontent [Options]}

In principal, the table of contents will contain absolutely all numbered
sections, although we can limit its level of depth with the
\PlaceMacro{setupcombinedlist}\tex{setupcombinedlist} command (that we will
speak of further on). So, for example:

\type{\setupcombinedlist[content][list={chapter,section}]}

will limit the contents of the TOC to chapters and sections.

A peculiarity of this command is that it is sensitive to its location in
the source file. This is very easy to explain with a few examples, but much
more difficult if we want to specify exactly how the command works and
which headings are included in the TOC in each case. So let's start with
the examples:

\startitemize

  \item \tex{placecontent} placed at the beginning of the document, before
  the first section command (part, chapter or section, according to the
  situation) will generate a complete table of contents.

  \startSmallPrint

    I am not really sure that the table of contents generated by default is
    {\em complete}, I believe it does include enough levels of sectioning
    to be complete in most cases; but I suspect it will not go beyond the
    eighth level of sectioning. In any case, as mentioned above, we can
    adjust the sectioning level the TOC reaches with

    \type{\setupcombinedlist[content][list={chapter, section, subsection, ...}]}

  \stopSmallPrint

  \item By contrast, this same command located inside a part, chapter or
  section will exclusively generate a TOC of the content of that element,
  or in other words chapters, sections and other lower levels of sectioning
  of a specific part, or sections (and other levels) of a specific chapter,
  or subsections of a specific section.

\stopitemize

As for the technical and detailed explanation, in order to understand the
default operation of \tex{placecontent} properly, it is essential to
remember that the various sections are, in fact, {\em environments} for
\ConTeXt\ Mark~IV  that start with \tex{startSectionType} and end with
\tex{stopSectionType} and can be contained within other lower level section
commands. So, taking that into account, we can say that \tex{placecontent}
generates by default a table of contents that will only include:

\startitemize

  \item Elements that belong to the {\em environment} (section level) where
  the command is placed. This means that the command when placed in a
  chapter will not include sections or subsections from other chapters.

  \item Elements that have a sectioning level lower than the level
  corresponding to the point where the command is located. Meaning that if
  the command is in a chapter, only sections, subsections and other lower
  levels are included; but if the command is in a section, it will be split
  to make the TOC of the subsection level.

\stopitemize

Furthermore, for the table of contents to be generated, it is required that
\tex{placecontent} be found {\em before} the first section of the chapter
in which it is located, or before the first subsection of the section in
which it is located, etc.

\startSmallPrint

  I'm not sure I was clear in the explanation above. Perhaps with a
  somewhat more detailed example than the previous ones we can better
  understand what I mean: let's imagine the following structure of a
  document:

\vbox{ \startitemize[packed]

  \item Chapter 1

    \startitemize[packed]

    \item Section 1.1

    \item Section 1.2

      \startitemize[packed]

      \item Subsection 1.2.1

      \item Subsection 1.2.2

      \item Subsection 1.2.3

      \stopitemize

    \item Section 1.3

    \item Section 1.4

    \stopitemize

  \item Chapter 2

  \stopitemize}

  So: \tex{placecontent} placed before Chapter 1 will generate a complete
  table of contents, similar to the one generated by \tex{completecontent}
  but without a title. But if the command is placed within Chapter 1 and
  before section 1.1, the table of contents will be only of the chapter;
  and if it is placed at the beginning of section 1.2, the table of
  contents will be only the content of that section. But if the command is
  placed, for example, between sections 1.1 and 1.2 it will be ignored. It
  will also be ignored if it is placed at the end of a section, or at the
  end of the document.

\stopSmallPrint

All of this, of course, refers only to the case where the command does not
include options. In particular, the {\tt criterium} option will alter that
default behaviour.

Of the options allowed by \tex{placecontent} I will only explain two of
them, the most important ones for setting up the TOC, and, moreover, the
only ones that are (partially) documented in the \ConTeXt\ reference
manual. The {\tt criterium} option, which affects the content of the TOC in
relation to the place in the source file where the command is located; and
the {\tt alternative} option, which affects the general layout of the TOC
to be generated.

\stopsubsection

\startsubsection
  [
    reference=sec:criteriumlist,
    title={Elements to incorporate in the TOC: the {\tt criterium} option},
  ]

The default operation of \tex{placecontent} in relation to the position of
the command in the source file has been explained above. The {\tt
criterium} option alters this operation. Among others, it can take the
following values:

\startitemize

  \item {\tt all}: the TOC will be complete, regardless of the place in the
  source file where the command is found.

  \item {\tt previous}: the TOC will only include the section commands (of
  the level we are at) {\em previous} to \tex{placecontent}. This option is
  intended for TOCS that are written at the end of the document or section
  in question.

  \item {\tt part, chapter, section, subsection...}: implies that the TOC
  should be limited to the sectioning level indicated.

  \item {\tt component}: in multifile projects (see
  \in{section}[sec-projects]), it will generate only the TOC corresponding
  to the {\em component} where the \tex{placecontent} or
  \tex{completecontent} command is found.

\stopitemize

\stopsubsection

\startsubsection
  [
    reference=sec:alternativelist,
    title={Layout of the table of contents: the {\tt alternative} option},
  ]

The {\tt alternative} option controls the overall layout of the table of
contents. Its main values can be see in
\in{table}[tbl:contentalternatives].

\placetable
  [here]
  [tbl:contentalternatives]
  {\tfx Ways of formatting the table of contents}
{\switchtobodyfont[small]
\starttabulate[|c|l|l|]
\HL
\NC {\bf alternative}
\NC {\bf Contents of TOC entries}
\NC {\bf Notes}
\NR
\HL
\NC a
\NC Number -- Title -- Page
\NC One line per entry
\NR
\NC b
\NC Number -- Title -- Spaces -- Page
\NC One line per entry
\NR
\NC c
\NC Number -- Title -- Leader dots -- Page
\NC One line per entry
\NR
\NC d
\NC Number -- Title -- Page
\NC Continuous TOC
\NR
\NC e
\NC Title
\NC Framed
\NR
\NC f
\NC Title
\NC Left aligned,
\NR
\NC\NC\NC right aligned or centred
\NR
\NC g
\NC Title
\NC Centred
\NR
\HL
\stoptabulate}

The first four alternative values provide all the information of each
section (its number, its title and the page number where it begins), and
are therefore suitable for both paper and electronic documents. The last
three alternatives only inform us about the title, so they are only
suitable for electronic documents where it is not necessary to know the
page number where a section begins, provided that the TOC includes a
hyperlink to it, which happens by default in \ConTeXt.

Furthermore, I believe that in order to truly appreciate the differences
between the various alternatives, it is best for the reader to generate a
test document where he or she can analyse them in detail.

\stopsubsection

\startsubsection
  [
    reference=sec:setuplist,
    title=Format of TOC entries,
  ]
  \PlaceMacro{setuplist}

We have seen that the {\tt alternative} option of \tex{placecontent} or
\tex{completecontent} allows us to control the general {\em layout} of the
table of contents, i.e. what information will be shown for each heading,
and whether or not there will be line breaks separating the different
headings. Final adjustments to each TOC entry are made with the
\tex{setuplist} command whose syntax is as follows:

\type{\setuplist[Element][Configuration]}

where {\em Element} refers to a particular kind of section. This could be
{\tt part}, {\tt chapter}, {\tt section}, etc. We can also configure more
than one element at the same time, separating them with commas. {\em
Configuration} has up to 54 possibilities, many of them, as usual, not
expressly documented; but this does not prevent those that are documented,
or the ones that are not clear enough from allowing full adjustment of the
TOC.

I will now explain the most important options, grouping them according to
their usefulness, but before going into them let us remember that a TOC
entry, depending on the value of the {\tt alternative}, can have up to
three different components: The section number, the title of the section,
and the page number. The configuration options allow us to configure the
various components globally or separately:

\startitemize

  \item {\em Inclusion (or not) of the different components}: If we have
  chosen an alternative that includes, in addition to the title, the
  section number and the page number (alternatives \quote{a} \quote{b}
  \quote{c} or \quote{d}), the options {\tt headnumber=no} or {\tt
  pagenumber=no}, it means that for the specific level we are configuring,
  the section number ({\tt headnumber}) or the page number ({\tt
  pagenumber}) is not displayed.

  \item {\em Colour and style}: We already know that the entry that
  generates a   specific section in the TOC may have (depending on  the
  alternative) up to three different components: section number, title and
  page number. We can jointly indicate the style and  the colour for the
  three components using the {\tt style}  and {\tt color} options, or do it
  individually for each  component by means of {\tt numberstyle, textstyle}
  or {\tt pagestyle}  (for the style) and {\tt numbercolor, textcolor} or
  {\tt pagecolor}  for the colour.

  To control the appearance of each entry, in addition to the style itself,
  we can apply some command to the whole  entry or to one of its different
  elements. For this there are the  {\tt command}, {\tt numbercommand},
  {\tt pagecommand} and  {\tt textcommand} options. The command indicated
  here can be a  standard \ConTeXt\ command or a command of our own
  creation. Section number, title text and page number will be passed as
  arguments to the {\tt command} option, while the section title will be
  passed as an argument to {\tt textcommand} and page number to {\tt
  pagecommand}. So, for example, the following sentence will ensure that
  section titles are written in (fake) small caps:

  \starttyping

    \setuplist[section][textcommand=\Cap]

  \stoptyping

  \item {\em Separation of the other TOC elements}: The {\tt before} and
  {\tt after} options allow us to indicate the commands that will be
  executed before ({\tt before}) and after ({\tt after}) typesetting the
  TOC entry. Normally these commands are used to set either the spacing or
  some separating element between the previous and subsequent entries.

  \item {\em Indenting an element}: set with the {\tt margin} option which
  allows us to set the amount of left indentation that the entries of the
  level we are configuring will have.

  \item {\em Hyperlinks embedded in the TOC}: By default the index entries
  include a hyperlink to the document page where the section in question
  begins. Using the  {\tt interaction} option we can disable this function
  ({\tt interaction=no}) or limit the part of the index entry where the
  hyperlink will be, which can be the section number  ({\tt
  interaction=number} or {\tt interaction=sectionnumber}), the  section
  title ({\tt interaction=text} or {\tt   interaction=title}) or the page
  number ({\tt interaction=page}  or {\tt interaction=pagenumber}).

  \item {\em Other aspects}:

  \startitemize

    \item {\tt width}: specifies the separation distance between the number
    and title of the section. It can be a dimension, or the keyword {\tt
    fit} that sets the exact width of the section number.

    \item {\tt symbol}: allows the section number to be replaced by a {\em
    symbol}. Three possible values are supported: {\tt one}, {\tt two} and
    {\tt three}. The value {\tt none} for this option removes the section
    number from the TOC.

    \item {\tt numberalign}: indicates the alignment of numbering elements;
    it can be left, right, middle, flushright, flushleft.

  \stopitemize

\stopitemize

Among the multiple configuration options of the TOC, there are none that
allows us to directly control the interline spacing. This will be, by
default, the one that applies to the document as a whole. Often, however,
it is preferable that lines in the TOC are slightly {\em tighter} than the
rest of the document. To achieve this we should enclose the command that
generates the table of contents (\tex{placecontent} or
\tex{completecontent}) within of a group where a different interline
spacing is established. For example:

\starttyping
\start
  \setupinterlinespace[small]
  \placecontent
\stop
\stoptyping

\stopsubsection

\startsubsection
  [
    reference=sec:manual adjustments,
    title=Manual adjustments to the table of contents,
  ]

We have already explained the two fundamental commands for generating
tables of contents (\tex{placecontent} and \tex{completecontent}), as well
as their options. With these two commands, TOCs are automatically
generated, constructed from the existing numbered sections in the document,
or in the block or segment of the document to which the table of contents
refers. I will now explain certain {\em settings} that we can make so that
the content of the TOC is not so {\em automatic}. This implies:

\startitemize

  \item The possibility of also including some unnumbered section titles in
  the TOC.

  \item The possibility of manually sending a particular entry to the TOC
  that does not correspond to the presence of a numbered section.

  \item The possibility of excluding a particular numbered section from the
  TOC.

  \item The possibility that the title for a particular section reflected
  in the TOC does not coincide exactly with the title included in the body
  of the document.

\stopitemize

\stopsubsection

\startsubsubsection
  [
    reference=sec:toc with unnumbered secs,
    title=Including unnumbered sections in the TOC,
  ]

The mechanism by which \ConTeXt\ builds the TOC means that all numbered
sections are automatically included, which, as I have already said (see
\in{section}[sec:title parts]) depends on the two ({\tt number} and {\tt
incrementnumber}) options that we can change with \tex{setuphead} for each
kind of section. It was also explained there that a section type where {\tt
incrementnumber=yes} and {\tt number=no} would be an internally but not
externally numbered section.

Therefore, if we want a particular unnumbered section type -- for example,
{\tt title} -- to be included in the TOC, we must change the value of the
{\tt incrementnumber} option for that section type, setting it to {\tt yes}
and then include that section type among those to be displayed in the TOC,
which is done, as explained above, with \tex{setupcombinedlist}:

\starttyping
  \setuphead
    [title]
    [incrementnumber=yes]

 \setupcombinedlist
   [content]
   [list={chapter, title, section, subsection, subsubsection}]
\stoptyping

We can then, if we wish, format this entry using \tex{setuplist} in exactly
the same way as any of the others; for example:

\type{\setuplist[title][style=bold]}

{\bf Note:} The procedure just explained will include all instances in our
document of the unnumbered section type concerned (in our example the {\tt
title} type sections). If we only wish to include a particular occurrence
of that section type in the TOC, it is preferable to do so by the procedure
explained below.

\stopsubsubsection

\startsubsubsection
  [
    reference=sec:manualtoc,
    title=Manually adding entries to the TOC,
  ]

We can send either an entry (simulating the existence of a section that
does not really exist) or a command to the table of contents, from any
point in the source file.

To send an entry that simulates the existence of a section that does not
really exist, use the  \PlaceMacro{writetolist}\tex{writetolist} whose
syntax is:

\type{\writetolist[SectionType][Options]{Number}{Text}}

in which

\startitemize

  \item The first argument indicates the level that this section entry must
  have in the TOC: {\tt chapter}, {\tt section}, {\tt subsection}, etc.

  \item The second argument, which is optional, allows this entry to be
  configured in a particular way. If the manually sent input is omitted, it
  will be formatted as are all the entries of the level indicated with the
  first argument; although, I must point out that in my tests I have not
  managed to make it work.

  \startSmallPrint

    Both in the official list of \ConTeXt\ commands (see
    \in{section}[sec:qrc-setup-en]) and in the wiki we are told that this
    argument allows the \Doubt same values as \tex{setuplist} which is the
    command that allows us to format the different TOC entries. But, I
    insist, in my tests I have not managed to change the appearance of the
    TOC entry sent manually in any way.

  \stopSmallPrint

  \item The third argument is supposed to reflect the numbering that the
  element sent to the \Doubt TOC has, but I couldn't get this to work in my
  tests either.

  \item The last argument includes the text to be sent to the TOC.

\stopitemize

This is useful, for example, if we want to send a particular unnumbered
section, but only that to the TOC. In \in{section}[sec:toc with unnumbered
secs] it explains  how to get an entire category of unnumbered sections to
be sent to the table of contents; but if we only want to send a particular
occurrence of a section type to it, it is more convenient to use the
\tex{writetolist} command. And so, for example, if we want the section of
our document containing the bibliography not to be a numbered section, but
still to be included in the TOC, we would write:

\starttyping
\subject{Bibliography}
\writetolist[section]{}{Bibliography}
\stoptyping

See how we are using the unnumbered version of {\tt section}, which is {\tt
subject}, for the section but we are sending it to the index, manually, as
if it were a numbered section ({\tt section}).

Another command intended to influence the table of contents manually is
\PlaceMacro{writebetweenlist}\tex{writebetweenlist} which is used to send
not an entry itself, but a {\em command} to the table of contents, from a
particular point in the document. For example, if we want to include a line
between two items in the TOC, we could write the following at any point in
the document located between the two sections concerned:

\type{\writebetweenlist[section]{\hrule}}

\stopsubsubsection

\startsubsubsection
  [title=Exclude a particular section from the TOC belonging to a section type that is included in the TOC]

The table of contents is constructed from {\em section types} established,
as we already know, by the {\tt list} option of \tex{setupcombinedlist}, so
if a certain {\em section type} must appear in the TOC, there is no way of
excluding a particular section from it that for whatever reasons we don't
want in the TOC.

Normally, if we don't want a section to appear there, what we would do is
to use its {\em unnumbered equivalent} meaning, for example, {\tt title}
instead of {\tt chapter}, {\tt subject} instead of {\tt section}, etc.
These sections are not sent to the TOC, and neither are they numbered.

However, if for any reason we want a certain section to be numbered but not
appear in the table of contents, even if other types of this kind do, we
can use a {\em trick} which consists of creating a new section type that is
a clone of the section in question. For example:

\starttyping
\definehead[MySubsection][subsection]
\section{First section}
\subsection{First subsection}
\MySubsection{Second subsection}
\subsection{Third subsection}
\stoptyping

This will ensure that when inserting a section type {\tt MySubsection} the
subsection counter will increase, since this section is a {\em clone} of
the subsections, but the TOC will not be altered, since by default it does
not include {\tt MySubsection} types.

\stopsubsubsection

\startsubsubsection
  [title=Section title text which differs in the TOC from the title in the body of the document]

If we do not want the title of a particular section included in the TOC to
be identical to the one displayed in the body of the document, we have two
procedures available to us:

\startitemize

  \item  Creating the section not with traditional syntax
  (\type{SectionType{Title}}) but with \tex{SectionType [Options]}, or with
  \tex{startSectionType [Options]}, and assign  the text we want to be
  written in the TOC to the {\tt list} option (see
  \in{section}[sec:sectionsyntax]).

  \item When writing the title of the section in question in the body of
  the document, use the \tex{nolist} command: this command causes the text
  it takes as an argument to be replaced in the TOC by an ellipsis. For
  example:

\starttyping
\chapter
  [title={An \nolist{approximate and slightly repetitive}
           introduction to the reality of the obvious}]
\stoptyping

  would typeset as the chapter title in the body of the document,
  \quotation{An approximate and slightly repetitive introduction to the
  reality of the obvious}, but would send the following text to the TOC
  \quotation{An ... introduction to the reality of the obvious}.

  \startSmallPrint

    {\bf Attention:} What I have just pointed out about the \tex{nolist}
    command is stated in both the \ConTeXt\ reference manual and the
    \goto{wiki}[url(https://wiki.contextgarden.net/Command/nolist)]. For
    me, however, it produces a compiling error, telling me that the
    \tex{nolist} command is undefined.

  \stopSmallPrint

\stopitemize

\stopsubsubsection

\stopsubsection

\stopsection

\startsection
  [
    reference=sec:lists,
    title={Lists, combined lists and table of contents based on a list},
  ]

Internally, for \ConTeXt, a table of contents is nothing more than a {\em
combined list}, which, in turn, as its name suggests, consists of a
combination of simple lists. Therefore the basic notion from which
\ConTeXt\ builds the table of contents is that of a list. Several lists are
combined to form a table of contents. By default, \ConTeXt\ contains a
predefined combined list called \MyKey{content} and this is what the
commands examined so far work with: \tex{placecontent} and
\tex{completecontent}.

\startsubsection
  [title=Lists in \ConTeXt]

In \ConTeXt, a {\em list} is a range of numbered elements about which we
need to remember three things:

\startitemize[n]

  \item The number.

  \item The name or title.

  \item The page where it is found.

\stopitemize

This happens with numbered sections; but also with other elements of the
document such as images, tables, etc. In general, those elements for which
there is a command whose name begins with \tex{place} which places them as
\tex{placetable}, \tex{placefigure}, etc.

In all these cases, \ConTeXt\ automatically generates a list of the
different times the type of element in question appears, its number, title
and page. Thus, for example, there is a list of chapters, called {\tt
chapter}, another of sections, called {\tt section}; but also another of
tables (called {\tt table}) or images (called {\tt figure}). Lists
generated automatically by \ConTeXt\ are always called the same as the item
they store.

A list will also be automatically generated if we create, for example, a
new type of numbered section: when we create it we will be implicitly
creating also the list that stores them. And if for a non-numbered section
by default, we set the option {\tt incrementnumber=yes}, making it a
numbered section, we will also be implicitly creating a list with that
name.

Together with the implicit lists (automatically defined by \ConTeXt) we can
create our own lists with \tex{definelist}, whose syntax is

\PlaceMacro{definelist}\type{\definelist[ListName][Configuration]}

Items on the list are added:

\startitemize

  \item In lists predefined by \ConTeXt, or created by it as a result of
  creating a new floating object (see \in{section}[sec:definefloat]),
  automatically each time an item from the list is inserted into the
  document, either by a sectioning command or by the \tex{placeWhatever}
  command for other types of lists, for example: \tex{placefigure}, will
  insert any image in the document, but it will also insert the
  corresponding entry in the list.

  \item Manually in any kind of list with \tex{writetolist[ListName]},
  already explained in \in{subsection}[sec:manualtoc] of
  \in{section}[sec:manual adjustments]. The \tex{writebetweenlist} command
  is also available. It too was explained in that section.

\stopitemize

Once a list has been created and all its items included in it, the three
basic commands related to it are \tex{setuplist},
\PlaceMacro{placelist}\tex{placelist} and
\PlaceMacro{completelist}\tex{completelist}. The first allows us to
configure what the list looks like; the last two insert the list in
question at the point in the document where it finds them. The difference
between \tex{placelist} and \tex{completelist} is similar to the difference
between \tex{placecontent} and \tex{completecontent} (see sections
\in{}[sec:completecontent] and \in{}[sec:placecontent]).

So, for example,

\type{\placelist[section]}

will insert a list of the sections, including a hyperlink to them if the
document's interactivity is enabled and if, in \tex{setuplist}, we have
not set {\tt interaction=no}. A list of sections is not exactly the same as
a table of contents based on sections: the idea of a table of contents
usually includes the lower levels as well (sub-sections, subsubsections,
etc.). But a list of sections will include only the sections themselves.

The syntax of these commands is:

\type{\placelist[ListName][Options]}

\type{\setuplist[ListName][Configuration]}

The \tex{setuplist} options have already been explained in
\in{section}[sec:setuplist], and the options for \tex{placelist} are the
same as for \tex{placecontent} (see \in{section}[sec:placecontent]).

\stopsubsection

\startsubsection
  [
    reference=sec:variouslists,
    title={Lists or indexes of images, tables and other items},
  ]

From what has been said so far, it can be seen that, since \ConTeXt\
automatically creates a list of images placed in a document with the
\tex{placefigure} command, generating a list or index of images at a
particular point in our document is as simple as using the
\tex{placelist[figure]} command. And if we want to generate a list with a
title (similar to what we get with \tex{completecontent}) we can do it with
\tex{completelist[figure]}. We can do similarly with the other four
predefined kinds of floating objects in \ConTeXt: tables (\MyKey{table}),
Graphics (\MyKey{graphic}), {\em intermezzos} (\MyKey{intermezzo}) and
chemical formulas (\MyKey{chemical}), although for specific cases of these,
\ConTeXt\ already includes a command that generates them without a title:
(\PlaceMacro{placelistoffigures}\tex{placelistoffigures},
\PlaceMacro{placelistoftables}\tex{placelistoftables},
\PlaceMacro{placelistofgraphics}\tex{placelistofgraphics},
\PlaceMacro{placelistofintermezzi}\tex{placelistofintermezzi} and
\PlaceMacro{placelistofchemicals}\tex{placelistofchemicals}), and another that generates them with a title:
(\PlaceMacro{completelistoffigures}\tex{completelistoffigures},
\PlaceMacro{completelistoftables}\tex{completelistoftables},
\PlaceMacro{completelistofgraphics}\tex{completelistofgraphics},
\PlaceMacro{completelistofintermezzi}\tex{completelistofintermezzi} and
\PlaceMacro{completelistofchemicals}\tex{completelistofchemicals}), in a similar way to \tex{completecontent}.

In the same way, for floating objects we ourselves have created (see
\in{section}[sec:definefloat]) the \tex{placelistof<FloatName>} and
\tex{completelistof<FloatName>} will be automatically created.

For lists we have created with \tex{definelist} we can create an index with
\tex{placelist[ListName]} or with \tex{completelist[ListName]}.

\stopsubsection

\startsubsection
  [title=Combined lists]

A combined list is, as its name suggests, a list that combines items from
different previously defined lists. By default, \ConTeXt\ defines a
combined list for tables of content whose name is \MyKey{content}, but we
can create other combined lists with
\PlaceMacro{definecombinedlist}\tex{definecombinedlist} whose syntax is:

\type{\definecombinedlist[Name][Lists][Options]}

where

\startitemize

  \item {\em Name}: is the name the new combined list will have.

  \item {\em Lists}: refers to the names of lists to be combined, separated
  by commas.

  \item {\em Options}: Configuration options for the list. They can be
  indicated at the time of defining the list, or, probably preferably, when
  the list is invoked. The main options (which have already been explained)
  are {\tt criterium} (\in{subsection}[sec:criteriumlist] of \in{section}
  [sec:placecontent]) and {\tt alternative} (in
  \in{subsection}[sec:alternativelist] in the same section).

\stopitemize

A collateral effect of creating a combined list with
\tex{definecombinedlist} is that it also creates a command called
\tex{placeListName} which serves to invoke the list, that is: to include it
in the output file. So for example,

\type{definecombinedlist[TOC]}

will create the command \tex{placeTOC}; and

\type{definecombinedlist[content]}

will create the command \tex{placecontent}

But wait, \tex{placecontent}! Isn't this the command that is used to create
a {\em normal} table of contents? Indeed: this means that the standard
table of contents is actually created by \ConTeXt\ by means of the
following command:

\starttyping
\definecombinedlist
  [content]
  [part, chapter, section, subsection,
    subsubsection, subsubsubsection,
    subsubsubsubsection]
\stoptyping

Once our combined list is defined, we can configure it (or reconfigure it)
with \tex{setupcombinedlist} which allows the already explained options
{\tt criterium} (see \in{subsection}[sec:criteriumlist] in
\in{section}[sec:placecontent]) and {\tt alternative} (see
\in{subsection}[sec:alternativelist] in the same section), as well as the
{\tt list} option to {\em change} the lists included in the combined list.

\startSmallPrint

  The official list of \ConTeXt\ commands (see
  \in{section}[sec:qrc-setup-en]) does not mention the {\tt list} option
  among the options allowed for \tex{setupcombinedlist}, but it is used in
  several examples of the use of this command in the wiki (which, moreover,
  does not mention it in the page devoted to this command either). I have
  also checked that the option works.

\stopSmallPrint

\stopsubsection

\stopsection

\startsection
  [title=Index]

\startsubsection
  [title=Generating the index]

A subject index consists of a list of significant terms, usually located at
the end of a document, indicating the pages where such a subject can be
found.

When books were put typeset by hand, generating a subject index was a
complex task, as well as a tedious one. Any change in the pagination could
affect all the entries in the index. Therefore, they were not very common.
Today, the computer mechanisms for typesetting mean that, while the task is
likely to continue being tedious, it is no longer so complex given that it
is not so difficult for a computer system to maintain an up-to-date list of
data associated with an index entry.

To generate a subject index we need:

\startitemize[n]

  \item Determine which words, terms or concepts are to be part of it. This
  is a task that only the author can do.

  \item Check at which points in the document each entry in the future
  index appears. Although, to be precise, more than {\em checking} the
  places in the source file where the concept or issue is discussed, what
  we do when we work with \ConTeXt\ is {\em to mark} those spots, inserting
  a command that will then serve to generate the index automatically. This
  is the tedious part.

  \item Finally, we generate and format the index by placing it at the
  point of our choice in the document. The latter is quite simple with
  \ConTeXt\ and requires only one command: \tex{placeindex}.

\stopitemize

\subsubsection{The prior definition of the entries in the index and the
marking of the points in the source file that refer to them}

The fundamental work is in the second step. It is true that computer
systems also facilitate it in the sense that we can do a global text search
to locate the places in the source file where a specific subject is
treated. But we should also not blindly rely on such text searches: a good
subject index must be able to detect every spot where a particular subject
is being discussed, even if this is done without using the {\em standard}
term to refer to it.

To {\em mark} an actual point in the source file, associating it with a
word, term or idea that will appear in the index, we use the
\PlaceMacro{index}\tex{index} command whose syntax is as follows:

\type{\index[Alphabetical]{Index entry}}

where {\em Alphabetical} is an optional argument that is used to indicate
an alternative text to that of the index entry itself in order to sort it
alphabetically, and {\em Index entry} is the text that will appear in the
index, associated with this mark. We can also apply the formatting features
that we wish to use, and if reserved characters appear in the text, they
must be written in the usual way in \ConTeXt.

\startSmallPrint

  The possibility of alphabetising an index entry in a way  different from
  how it is actually written, is very useful. Think, for example, of this
  document, if I want to generate  an entry in the index for all references
  to the \tex{TeX} command. For example, the sequence
  \type{\index{\backslash TeX}} will list the command not by the \quote{t}
  in \quote{TeX}, but among the symbols, since the term sent to the index
  begins with a backslash. This is done by writing
  \type{\index[tex]{\backslash TeX}}.

\stopSmallPrint

The {\em index entries} will be the ones we want. For a subject index to be
really useful we have to work a little harder at asking what concepts the
reader of a document is most likely to look for; so, for example, it may be
better to define an entry as \quotation{disease, Hodgkins} than defining it
as \quotation{Hodgkin's disease}, since the more inclusive term is
\quotation{disease}.

\startSmallPrint

  By convention, entries in a subject index are always written in lower
  case, unless they are proper names.

\stopSmallPrint

If the index has several levels of depth (up to three are allowed) to associate a particular index entry with a specific level the \quote{+} character is used. As follows:

\starttyping
\index{Entry 1+Entry 2}
\index{Entry 1+Entry 2+Entry 3}
\stoptyping

In the first case we defined a second level entry called {\em Entry 2} that
will be a sub-entry of {\em Entry 1}. In the second case we defined a third
level entry called {\em Entry 3} that will be a sub-entry of {\em Entry 2},
which in turn is a sub-entry of {\em Entry 1}.  For example

\vbox{
\starttyping
My \index{dog}dog, is a \index{dog+greyhound}greyhound called Rocket.
He does not like \index{cat+stray}stray cats.
\stoptyping}

It is worth noting some details of the above:

\startitemize

  \item The \tex{index} command is usually placed {\em before} the word it
  is associated with and is normally not separated from it by a a blank
  space. This is to ensure that the command is on the exact same page as
  the word it is linked to:

  \startitemize

      \item If there were a space separating them, there could be the
      possibility that \ConTeXt\ would choose just that space for a line
      break which could also end up being a page break, in which case the
      command would be on one page and the word it is associated with on
      the next page.

    \item If the command were to come {\em after} the word, it would be
    possible for this word to be broken by syllables and a line break
    inserted between two of its syllables that would also be a page break,
    in which case the command would be pointing to the next page beginning
    with the word it points to.

  \stopitemize

  \item See how second level terms are introduced in the second and third
  appearances of the command.

  \item Also check how, in the third use of the \tex{index} command,
  although the word that appears in the text is \quotation{cats}, the term
  that will be sent to the index is \quotation{cat}.

  \item Finally: see how three entries for the subject index have been
  written in just two lines. I said before that marking the precise places
  in the source file is tedious. I will now add that marking too many of
  them is counter-productive. Too extensive an index is by no means
  preferable to a more concise one in which all the information is
  relevant. That is why I said before that deciding which words will
  generate  entry in the index should be the result of a conscious decision
  by the author.

\stopitemize

If we want our index to be truly useful, terms that are used as synonyms
must be grouped in the index under one head term. But since it is possible
for the reader to search the index for information by any of the other head
terms, it is common for the index to contain entries that refer to other
entries. For example, the subject index of a civil law manual could just as
easily be something like

\startframedtext[frame=off]

  contractual invalidity\\
  \qquad see {\em nullity}.

\stopframedtext

We achieve this not with the \tex{index} command but with
\PlaceMacro{seeindex}\tex{seeindex} whose format is:

\type{\seeindex [Alphabetical] {Entry1} {Entry2}}

where {\em Entry1} is the index entry that will refer to the other; and
{\em Entry2} is the reference target. In our previous example we would have
to write:

\starttyping
\seeindex{contractual invalidity}{nullity}
\stoptyping

In \tex{seeindex} we can also use the \quote{+} sign to indicate sub-levels
for either of its two arguments in square brackets.

\subsubsection{Generating the final index}

Once we have marked all the entries for the index in our source file, the
actual generation of the index is carried out using the
\PlaceMacro{placeindex}\tex{placeindex} or
\PlaceMacro{completindex}\tex{completindex} commands. These two commands
scan the source file for the \tex{index} commands, and generate a list of
all the entries that the index should have, associating a term with the
page number corresponding to where it found the \tex{index} command. Then
they alphabetically order the list of terms that appear in the index and
merge cases where the same term appears more than once, and finally, they
insert the correctly formatted result in the final document.

The difference between \tex{placeindex} and \tex{completeindex} is similar
to the difference between \tex{content} and \tex{completecontent} (see
\in{section}[sec:completecontent]): \tex{placeindex} is limited to
generating the index and inserting it, while \tex{completeindex} previously
inserts a new chapter in the final document, called \quotation{Index} by
default, inside which the index will be typeset.

\stopsubsection

\startsubsection
  [title=Formatting the subject index]
  \PlaceMacro{setupregister}

Subject indexes are a particular application of a more general structure
\ConTeXt\ calls \quotation{\em register}; therefore the index is formatted
with the command:

\type{\setupregister[index][Configuration]}

With this command we can:

\startitemize

  \starthead Determine what the index will look like with its different
  elements. Namely:\stophead   %\head only doesn't work wikth LMTX

  \startitemize

    \item The index headings which are usually letters of the alphabet. By
    default these are in lower case. With {\tt alternative=A} we can set
    them to be in upper case.

    \item The entries themselves, and their page number. The appearance
    depends on the {\tt textstyle, textcolor, textcommand} and {\tt
    deeptextcommand} options for the actual entry, and {\tt pagestyle,
    pagecolor} and {\tt pagecommand}, for the page number. With {\tt
    pagenumber=no} we can also generate a subject index without page
    numbers (although I don't know if this could be useful).

    \item The {\tt distance} option measures the width of separation
    between the name of an entry and the page numbers; but it also measures
    the amount of indentation for subentries.

  \stopitemize

  The names of the {\tt style}, {\tt textstyle}, {\tt pagestyle}, {\tt
  color}, {\tt textcolor}, and {\tt pagecolor} options are clear enough to
  tell us what each one does I think. For {\tt command}, {\tt pagecommand},
  {\tt textcommand} and {\tt deeptextcommand}, I refer to the explanation
  for similarly named options in \in{section}[sec:titlestyle], regarding
  the configuration of section commands.

  \item To set the general appearance of the index, which includes, among
  others the commands to execute before ({\tt before}) or after({\tt
  after}) the index, the number of columns it needs to have ({\tt n}),
  whether the columns should be equal or not ({\tt balance}), the alignment
  of entries ({\tt align}), etc.

\stopitemize

\stopsubsection

\startsubsection
  [title=Creating other indexes]
  \PlaceMacro{defineregister}\PlaceMacro{setupregister}

I have explained the subject index as if only one such index would be
possible in a document; but the truth is that documents can have as many
indexes as desired. There could be an index of personal names, for example,
which collects the names of people mentioned in the document, with an
indication of the place where they are cited. These are still a kind of
index. In a legal text we could also create a special index for mentions of
the Civil Code; or, in a document like the present one, an index of macros
explained in it, etc.

To create an additional index in our document we use the
\tex{defineregister} command whose syntax is:

\type{\defineregister [IndexName] [Configuration]}

where {\em IndexName} is the name the new index will have, and {\em
Configuration} controls how it works. It is also possible to configure the
index later on by means of

\type{\setupregister [IndexName] [Configuration]}

Once a newly named index {\em IndexName} has been created  we will have the
\tex{IndexName} command at our disposal to mark the entries that this index
will have in a similar way to the way entries are marked with \tex{index}.
The \text{seeIndexName} command also lets us create entries that refer to
other entries.

For example: we could create an index of \ConTeXt\ commands in this
document with the command:

\type{\defineregister[macro]}

that would create the \tex{macro} command. This lets me mark all the
references to \ConTeXt\ commands as an index entry, and then generate the
index with \tex{placemacro} or \tex{completemacro}.

\startSmallPrint

  Creating a new index enables the \tex{IndexName} command to mark it
  entries, and the \tex{placeIndexName} and \tex{completeIndexName}
  commands for generating the index. But these latter two commands are
  actually abbreviations of two more general commands applied to the index
  in question. Thus, \tex{placeIndexName} is equivalent to
  \tex{placeregister[IndexName]} and \tex{completeIndexName} is equivalent
  to \tex{completeregister[IndexName]}.

\stopSmallPrint

\stopsubsection

\stopsection

\stopchapter

\stopcomponent

%%% Local Variables:
%%% mode: ConTeXt
%%% mode: auto-fill
%%% coding: utf-8-unix
%%% TeX-master: "../introCTX.mkiv"
%%% End:
%%% vim:set filetype=context tw=72 : %%%
