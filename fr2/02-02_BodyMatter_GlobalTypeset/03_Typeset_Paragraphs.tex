\startcomponent 02-04-01-01_Typeset_Paragraphs

\environment introCTX_env_00

%==============================================================================

\startchapter
  [title={Paragraphes},  %Paragraphes, lignes et espace vertical
  reference=cap:parlinevspace,]

\TocChap

{\externalfigure[demonstration.pdf][page=7,background=color,backgroundcolor=white]}

\startsection[title=Balisage]
  
L'aspect général d'un document est principalement déterminé  par la taille et la disposition des pages que nous avons vues dans le \in{Chapitre}[cap:pages], par la police de caractères que nous avons choisie, traitée dans le \in{Chapitre}[sec:fontscol], et par d'autres questions comme l'espacement entre les lignes, l'alignement des paragraphes et l'espacement entre eux, etc. Ce chapitre se concentre sur ces questions.


Le paragraphe est l'unité de texte fondamentale pour \ConTeXt. Il existe deux procédures pour commencer un paragraphe~:

\startitemize[n]

 \item Insertion d'une ou plusieurs lignes vides consécutives dans le fichier source.

  \item Les commandes 
\PlaceMacro{par}        \tex{par} ou
\PlaceMacro{endgraf}    \tex{endgraf}.

\stopitemize

La première de ces procédures est celle qui est normalement utilisée car elle est plus simple et produit des fichiers sources plus faciles à lire et à comprendre. L'insertion de sauts de paragraphe par une commande explicite n'est généralement réalisée qu'à l'intérieur d'une macro (voir \in{section}[sec:define]) ou dans une cellule de tableau (voir \in{section}[sec:tables]).

Dans un document bien typé, il est important, d'un point de vue typographique, que les paragraphes se distinguent visuellement les uns des autres. On y parvient généralement par deux procédés~: en indentant légèrement la première ligne de chaque paragraphe ou en augmentant légèrement l'espace blanc entre les paragraphes, et parfois par une combinaison des deux procédés, bien que dans certains endroits, cette méthode ne soit pas recommandée car elle est considérée comme redondante du point de vue typographique.


\startSmallPrint

Je ne suis pas tout à fait d'accord. Le simple retrait de la première ligne ne souligne pas toujours assez visuellement la séparation entre les paragraphes~; mais une augmentation de l'espacement non accompagnée d'un retrait pose des problèmes dans le cas d'un paragraphe qui commence en haut d'une page où nous ne pouvons pas savoir s'il s'agit d'un nouveau paragraphe, ou d'une continuation de la page précédente. Une combinaison des deux procédures permet d'éliminer les doutes.

\stopSmallPrint
\stopsection


% **  Subsection Espace interligne

\startsection
  [title=Espace interligne]


L'interligne est la distance séparant les lignes qui composent un paragraphe. \ConTeXt\ calcule automatiquement cette distance en fonction de la police utilisée et, surtout, de la taille de base définie avec \tex{setupbodyfont} ou \tex{switchtobodyfont}.

% DONE Garulfo added

\startSmallPrint

Plus précisément, l'espace interligne est  déterminée à partir de la taille de la police utilisée.  Elle  vaut dans \type{2.8ex}, un  \type{ex} étant la hauteur du caractère x. Une ligne  a une hauteur  et une profondeur.   La somme de  la hauteur maximale et de la profondeur maximale donne la distance interligne. % en première ligne du paragraphe espace est considéré comme féminin, ailleurs jusqu'à présent comme masculin. En typographie espace est féminine, mais cela vaut-il pour l'espace interligne ?

\placefigure [force,here,none] [] {}{
\startDemoHN
\leavevmode
\ruledhbox{%
\tfc Une ligne a une {\tt height} et une {\tt depth}~: 
\blackrule[height=max,depth=0pt] +
\blackrule[height=0pt,depth=max] =
\blackrule[height=max,depth=max]}
\stopDemoHN}

\stopSmallPrint



Nous pouvons influencer l'espace interligne avec la fonction \PlaceMacro{setupinterlinespace} \tex{setupinterlinespace} qui permet trois types de syntaxe différents~:

\startitemize

  \item \tex{setupinterlinespace [espace interligne]}, où {\em espace interligne} est une valeur précise ou un mot symbolique qui attribue un espace interligne prédéfini~:

  \startitemize

   \item Lorsqu'il s'agit d'une valeur précise, il peut s'agir d'une dimension (par exemple, 15pt), ou d'un nombre simple, entier ou décimal (par exemple, 1,2). Dans ce dernier cas, le nombre est interprété comme \quotation{nombre de lignes} en fonction de l'interligne par défaut de \ConTeXt.

    \item Lorsqu'il s'agit d'un mot symbolique, il peut s'agir de \MyKey{small}, \MyKey{medium} ou \MyKey{big}, chacun appliquant respectivement un espace interligne petit, moyen ou grand, toujours basé sur l'espace interligne par défaut que \ConTeXt\ appliquerait.


  \stopitemize

\item \tex{setupinterlinespace [..,..=..,..]}. Dans ce mode, l'espacement interligne est défini en modifiant explicitement les mesures sur la base desquelles \ConTeXt\ calcule l'espacement interligne approprié. Dans ce mode, l'espacement est défini en modifiant explicitement les mesures sur la base desquelles \ConTeXt\ calcule l'espacement approprié. J'ai dit précédemment que l'interligne est calculé sur la base de la police spécifique et de sa taille, mais c'était pour simplifier les choses~: en fait, la police et la taille servent à établir certaines mesures sur la base desquelles l'interligne est calculé. Grâce à cette approche \tex{setupinterlinespace}, ces mesures sont modifiées et, par conséquent, l'espace interligne l'est aussi. Les mesures et valeurs réelles qui peuvent être manipulées par cette procédure (dont je n'expliquerai pas la signification car cela dépasse le cadre d'une simple introduction) sont les suivantes~:  {\tt line, height, depth, minheight, mindepth, distance, top, bottom, stretch} et {\tt shrink}.  % l y a redite de la première phrase !

% DONE Garulfo added

\startSmallPrint

Les valeurs des paramètres  \type{top} et \type{bottom} déterminent la
hauteur de la première ligne et la profondeur de la dernière ligne sur
la page. Ce  sont également des ratios mais cette  fois appliqués à la
taille  de  la  police  de   corps  de  texte  (\type{bodyfont}).  Ces
paramètres sont  en rapport avec les  paramètres \TeX\ \type{\topskip}
et \type {\maxdepth}.

\stopSmallPrint

  \item \tex{setupinterlinespace [Nom]}. Avec ce mode, nous établissons ou configurons un type d'interligne spécifique et personnalisé, préalablement défini avec \PlaceMacro{defineinterlinespace} \tex{defineinterlinespace}.

\stopitemize

Les paramètres par défauts sont les suivants~:

\placefigure [force,here,none] [] {}{
\startDemoI
\setupinterlinespace
  [height=.72,
   depth=.28,
   top=1.0,
   bottom=0.4,
   line=2.8ex]
\stopDemoI}

Voyons un exemple

\placefigure [force,here,none] [] {}{
\startDemoHN
\startbuffer[texteinterligne]
Bordeaux est une commune du Sud-Ouest  de la France. Elle est capitale
de la Gaule aquitaine dès le  début du III\high{e} siècle. La ville est
connue dans le monde entier pour les vins et vignobles du Bordelais.
\stopbuffer

\defineparagraphs[TroisColumns][n=3,distance=0.04\textwidth]

\startTroisColumns
%
\getbuffer[texteinterligne]
\TroisColumns
%
\setupinterlinespace[1.25]
\getbuffer[texteinterligne]
\TroisColumns
%
\setupinterlinespace[1.5]
\getbuffer[texteinterligne]
%
\stopTroisColumns
\stopDemoHN}


Avec \PlaceMacro{defineinterlinespace} \tex{defineinterlinespace} nous pouvons associer une certaine configuration d'espace interligne à un nom spécifique que nous pouvons ensuite simplement déclencher à un moment donné dans notre document avec \tex{setupinterlinespace[Nom]}. Pour revenir à un espace interligne normal, nous devrions alors écrire \tex{setupinterlinespace[reset]}.


\placefigure [force,here,none] [] {}{
\startDemoI
\defineinterlinespace [Nom] [Configuration]
\stopDemoI}



\PlaceMacro{startlinecorrection}
En général, \ConTeXt\ gère correctement l'espace vertical entre les lignes, mais il arrive parfois qu'une ligne contienne quelque chose qui la rende incorrecte. Cela se produit principalement avec les lignes dont les fragments ont été encadrés avec \tex{framed}. Dans de tels cas, l'environnement \tex{startlinecorrection} ajuste l'espacement des lignes afin que le paragraphe apparaisse correctement.

\stopsection

% **  Subsection Espace vertical entre les paragraphes

\startsection
  [
    reference=sec:verticalspace,
    title={Espace vertical entre les paragraphes},
  ]

% *** Subsection \tex{setupwhitespace}
\startsubsubsection
  [title=\tex{setupwhitespace}]

Comme nous le savons déjà (\in{section}[sec:linebreaks]), le nombre de lignes vides consécutives dans le fichier source n'a aucune importance pour \ConTeXt{}~: une ou plusieurs lignes vides insèreront une seule coupure de paragraphe dans le document final. Pour augmenter l'espace entre les paragraphes, il n'est d'aucune utilité d'ajouter une ligne vierge supplémentaire dans le fichier source. En revanche, cette fonction est contrôlée par la commande \PlaceMacro{setupwhitespace} \tex{setupwhitespace} qui autorise les valeurs suivantes~:

\startitemize

\item {\tt\bf none}~: signifie qu'il n'y aura pas d'espace vertical supplémentaire entre les paragraphes.

\item {\tt\bf small, medium, big}~: ces valeurs insèrent, respectivement, un espace vertical petit, moyen ou grand. La taille réelle de l'espace inséré par ces valeurs dépend de la taille de la police.

\item {\tt\bf line, halfline, quarterline}~: indique l'espace en terme de hauteur des lignes et insère respectivement une ligne, une demi-ligne ou un quart de ligne d'espace supplémentaire.

\item {\tt\bf DIMENSION}~: établit une dimension réelle pour l'espace entre les paragraphes. Par exemple, \tex{setupwhitespace[5pt]}.

\stopitemize

En règle générale, il n'est pas conseillé de définir une dimension exacte comme valeur pour \tex{setupwhitespace}. Il est préférable d'utiliser les valeurs symboliques small, medium, big, line, halfline ou quarterline. Il en est ainsi pour deux raisons~:

\startitemize

\item Les valeurs symboliques small, medium, big, etc., sont calculées sur la base de la taille de la police, donc si celle-ci change dans certaines parties, cela changera également la quantité d'espacement vertical entre les paragraphes, et le résultat final sera toujours harmonieux. À l'inverse, une valeur fixe pour l'espacement vertical ne sera pas affectée par les changements de taille de police, ce qui se traduira normalement par un document avec des espaces blancs mal répartis (du point de vue esthétique) et non conformes aux règles de l'ajustement typographique.

\item Les valeurs symboliques sont des dimensions {\em élastiques} (voir \in{section}[sec:dimensions]), ce qui signifie qu'elles ont des dimensions {\em normales} mais qu'une certaine diminution ou augmentation de cette valeur est autorisée, afin d'aider \ConTeXt\ dans la composition des pages de sorte que les coupures de paragraphe soient esthétiquement similaires. Mais une mesure fixe de la séparation entre les paragraphes rend plus difficile l'obtention d'une bonne pagination pour le document.

\stopitemize

\PlaceMacro{startnarrower}
\placefigure [force,here,none] [] {}{
\startDemoVN%
\setupwhitespace[medium]%
Phrase 1.1.\par
Phrase 1.2.\par
Phrase 1.3.\par
\nowhitespace
Phrase 1.4.\par
Phrase 1.5.

\setupwhitespace[big]
Phrase 2.1.\par
Phrase 2.2.\par
Phrase 2.3.\par
\nowhitespace
Phrase 2.4.\par
Phrase 2.5.
\stopDemoVN}

Une fois la valeur définie pour l'espacement vertical des paragraphes, deux commandes supplémentaires sont disponibles~: \PlaceMacro{nowhitespace} \tex{nowhitespace}, qui élimine tout espace supplémentaire entre des paragraphes particuliers, et \PlaceMacro{whitespace} \tex{whitespace} qui fait le contraire. Cependant, ces commandes sont rarement nécessaires, car le fait est que \ConTeXt\ gère assez bien l'espacement vertical entre les paragraphes par lui-même~; surtout si l'une des dimensions prédéfinies a été insérée comme valeur, calculée à partir de la taille de police et de la hauteur de ligne courantes.


\startSmallPrint

% TODO Garulfo à dégager car plutot source à confusion ?

La signification de \tex{nowhitespace} est évidente. Mais pas nécessairement celle de \tex{whitespace}, car quel est l'intérêt d'ordonner l'espacement vertical pour des paragraphes particuliers étant donné que l'espacement vertical a déjà été généralement établi \Conjecture pour tous les paragraphes~? Cependant, lors de l'écriture de macros avancées, \tex{whitespace} peut être utile dans le contexte d'une boucle qui doit prendre une décision en fonction de la valeur d'une certaine condition. Il s'agit d'une programmation plus ou moins avancée, et je ne m'y attarderai pas ici.

\stopSmallPrint

\stopsubsubsection

% *** Subsection
\startsubsubsection
  [title={Paragraphes sans espace vertical supplémentaire entre eux}]

Si nous voulons que certaines parties de notre document aient des paragraphes qui ne soient pas séparés par un espace vertical supplémentaire, nous pouvons bien sûr modifier la configuration générale de \tex{setupwhitespace}, mais cela est, d'une certaine manière, contraire à la philosophie de \ConTeXt\ selon laquelle les commandes de configuration générale doivent être placées exclusivement dans le préambule du fichier source, afin d'obtenir une apparence générale cohérente et facilement modifiable pour les documents. D'où l'environnement \MyKey{packed}, dont la syntaxe générale est la suivante

\PlaceMacro{startpacked}
\placefigure [force,here,none] [] {}{
\startDemoI
\startpacked [Espace] ... \stoppacked
\stopDemoI}

où {\em Espace} est un argument facultatif indiquant la quantité d'espace vertical souhaitée entre les paragraphes de l'environnement. S'il est omis, aucun espace vertical supplémentaire ne sera appliqué.

\stopsubsubsection

% *** Subsection
\startsubsubsection
  [title={Ajout d'un espace vertical supplémentaire à un endroit particulier du document}]


Si, à un endroit particulier du document, l'espacement vertical normal entre les paragraphes n'est pas suffisant, nous pouvons utiliser la commande \PlaceMacro{blank} \tex{blank}. Utilisée sans argument, \tex{blank} insère la même quantité d'espacement vertical que celle définie avec \tex{setupwhitespace}. Mais nous pouvons indiquer soit une dimension spécifique entre crochets, soit l'une des valeurs symboliques calculées à partir de la taille de la police~: small, medium ou big. Nous pouvons également multiplier ces tailles par un nombre entier, et ainsi de suite, par exemple, \tex{blank[3*medium]} insérera l'équivalent de trois sauts de ligne moyens. Nous pouvons également combiner deux tailles. Par exemple, \tex{blank[2*big, medium]} insérera deux sauts de ligne de grande taille et un de taille moyenne.

Puisque \tex{blank} est conçu pour augmenter l'espace vertical entre les paragraphes, il n'a aucun effet si un saut de page est inséré entre les deux paragraphes dont l'espacement doit être augmenté~; et si nous insérons deux ou plusieurs commandes \tex{blank} à la suite, seule l'une d'entre elles s'appliquera (celle dont l'espacement est le plus important). Une commande \tex{blank} placée après un saut de page n'a pas non plus d'effet. Toutefois, dans ces cas, nous pouvons forcer l'insertion d'un espacement vertical en utilisant le mot symbolique \MyKey{force} comme option de la commande. Ainsi, par exemple, si nous voulons que les titres des chapitres de notre document apparaissent plus bas sur la page, de sorte que la longueur totale de la page soit inférieure à celle du reste des pages (une pratique typographique relativement fréquente), nous devons écrire dans la configuration de la commande \tex{chapter}, par exemple~:


\placefigure [force,here,none] [] {}{
\startDemoVN
\startsection[title=C'est le titre]
C'est le texte de la section.
\stopsection
\stopDemoVN}

\placefigure [force,here,none] [] {}{
\startDemoVN
\setuphead
  [section]
  [page=yes,
   before={\blank[4cm, force]},
   after={\blank[3*medium]}]
\startsection[title=C'est le titre]
C'est le texte de la section.
\stopsection
\stopDemoVN}

Cette séquence de commandes garantit que les sections commencent toujours sur une nouvelle page et que l'étiquette du chapitre soit positionnée quatre centimètres vers le bas. Sans l'utilisation de l'option \MyKey{force}, cela ne fonctionnera pas.

\stopsubsubsection

% *** Subsection
\startsubsubsection
  [title=\tex{setupblank} et \tex{defineblank}]

\PlaceMacro{setupblank}\PlaceMacro{defineblank}


Plus tôt, j'ai dit que \tex{blank}, utilisé sans arguments, est équivalent à \tex{blank[big]}. Cependant, nous pouvons changer cela avec \tex{setupblank}, en le définissant comme \tex{setupblank[0.5cm]} par exemple, ou \tex{setupblank[medium]}. Utilisé sans argument, \tex{setupblank} ajustera la valeur à la taille de la police actuelle.

% TODO Garulfo revoir le wording

De même qu'avec \tex{setupwhitespace}, l'espace blanc inséré par \tex{blank}, lorsque sa valeur est l'une des valeurs symboliques prédéfinies, est une dimension élastique qui permet un certain ajustement. On peut la modifier avec \MyKey{fixed}, avec la possibilité, par la suite, de rétablir la valeur par défaut avec (\MyKey{flexible}). Ainsi, par exemple, pour un texte en double colonne, il est recommandé de définir \tex{setupblank[fixed, line]}, et lors du retour à une seule colonne de revenir à la définition initiale \tex{setupblank[flexible, default]}.

Avec \tex{defineblank}, nous pouvons associer une certaine configuration à un nom. Le format général de cette commande est le suivant~:


\PlaceMacro{startpacked}
\placefigure [force,here,none] [] {}{
\startDemoI
\defineblank [Name] [Configuration]
\stopDemoI}

Une fois que notre configuration d'espace blanc est définie, nous pouvons l'utiliser avec \tex{blank[Name]}.

\stopsubsubsection

% *** Subsection
\startsubsubsection
  [title={Autres procédures pour obtenir plus d'espace vertical}]


Dans \TeX\, la commande qui insère un espace vertical supplémentaire est \PlaceMacro{vskip} \tex{vskip}. Cette commande, comme presque toutes les commandes \TeX, fonctionne également dans \ConTeXt, mais son utilisation est fortement déconseillée car elle interfère avec le fonctionnement interne de certaines macros de \ConTeXt. À sa place, il est suggéré d'utiliser \PlaceMacro{godown}\tex{godown} dont la syntaxe est~:


\placefigure [force,here,none] [] {}{
\startDemoI
\godown[Dimension]
\stopDemoI}


où {\em Dimension} doit être un nombre avec ou sans décimales, suivi d'une unité de mesure. Par exemple, \tex{godown[5cm]} déplacera le prochain texte de 5 centimètres vers le bas~; toutefois, si le changement de page arrive avec l'atteinte de cette quantité, \tex{godown} ne fera que passer à la page suivante. De même, \tex{godown} n'aura aucun effet au début d'une page, bien que nous puissions {\em le tromper} en écrivant, par exemple \quotation{\cmd{\textvisiblespace \backslash godown[3cm]}}\footnote{Rappellez-vous que nous utilisons le caractère \quote{\textvisiblespace} dans ce document pour représenter un espace vide lorsqu'il est important pour nous de le voir. } qui va d'abord insérer un espace vide signifiant que nous ne sommes plus au début de la page, puis descendre de trois centimètres.


\startSmallPrint

Comme nous le savons, \tex{blank} permet également d'utiliser une dimension précise comme argument.   Par conséquent, du point de vue de l'utilisateur, écrire \tex{blank[3cm]} ou \tex{godown[3cm]} est pratiquement la même chose. Cependant, il existe quelques différences subtiles entre elles. Ainsi, par exemple, deux commandes \tex{blank} consécutives ne peuvent pas être cumulées et lorsque cela se produit, seule celle qui impose une plus grande distance est appliquée. En revanche, deux commandes \tex{godown} ou plus peuvent parfaitement se cumuler.

\placefigure [force,here,none] [] {}{
\startDemoVN
Texte 1.
\blank[1cm]
Texte 2.
\blank[1cm]
\blank[1cm]
Texte 3.
\godown[1cm]
Texte 4.
\godown[1cm]
\godown[1cm]
Texte 5.
\stopDemoVN}


\stopSmallPrint

Une autre commande \TeX\ plutôt utile, dont l'utilisation ne pose aucun problème dans \ConTeXt, est \PlaceMacro{vfill} \tex{vfill}. Cette commande insère un espace blanc vertical flexible allant jusqu'au bas de la page (c'est le pendant vertical de \tex{hfill} vu \in{section}[sec:horizontal space2]). C'est comme si la commande {\em poussait} vers le bas ce qui est écrit après elle. Cela permet d'obtenir des effets intéressants, comme placer un certain paragraphe en bas de la page, en le faisant simplement précéder de \tex{vfill}. Maintenant, l'effet du \tex{vfill} est difficile à apprécier si son utilisation n'est pas combinée avec des sauts de page forcés, car il n'y a pas beaucoup d'intérêt à pousser un paragraphe ou une ligne de texte vers le bas si le paragraphe, au fur et à mesure qu'il se développe, se développe vers le haut.

Ainsi, par exemple, pour s'assurer qu'une ligne est placée en bas de la page, il faut écrire~:


\placefigure [force,here,none] [] {}{
\startDemoI
\vfill
Ligne en bas.
\page[yes]
\stopDemoI}

Comme toutes les autres commandes qui insèrent un espace vertical, \tex{vfill} n'a aucun effet en début de page. Mais on peut encore {\em le tromper} en la faisant précéder d'un espace blanc forcé, ou bien d'un \tex{strut}. Ainsi, par exemple~:


\placefigure [force,here,none] [] {}{
\startDemoI
\page[yes]
\ \vfill
Ligne centrée verticalement.
\vfill
\stopDemoI}

\placefigure [force,here,none] [] {}{
\startDemoI
\strut\vfill
Ligne centrée verticalement.
\vfill
\stopDemoI}

permet de centrer verticalement la phrase sur la page.


% TODO Garuflo : c'est un vrai todo ici

Un {\tt strut}, ou {\em point d'appui} est un petit bloc invisible sans largeur mais avec la hauteur et la profondeur maximales d'un caractère ou d'une ligne. Nous y reviendrons plus tard, car cet élément est souvent utile dans de nombreux cas pour les auteurs et compositeur pointilleux (voir \in{section}[sec:strut]).  % supprimer "souvent" ou "dans de nombreux cas" redondance


\stopsubsubsection

\stopsection

% **  Subsection Justification, alignement horizontal et vertical

\startsection
  [
    reference=sec:alignment,
    title={Justification, alignement horizontal et vertical},
  ]

La commande qui contrôle l'alignement du texte en général est \PlaceMacro{setupalign} \cmd{set-up\-align}. Cette commande est utilisée pour contrôler l'alignement horizontal et vertical.

% *** >> Subsection
\startsubsubsection
  [
    reference=sec:setupalign,
    title={Alignement horizontal},
  ]

Lorsque la largeur {\em exacte} d'une ligne de texte n'occupe pas toute la largeur possible, cela pose le problème de savoir que faire avec l'espace blanc qui en résulte.\footnote{Par largeur {\em exacte}, j'entends la largeur de la ligne {\em avant}. \ConTeXt\ ajuste la taille de l'espace inter-mots pour permettre la justification.} Nous pouvons essentiellement faire trois choses à cet égard~:

\startitemize[n]

\item L'accumuler sur l'un des deux côtés de la ligne~: si nous l'accumulons sur le côté gauche, la ligne semblera {\em poussée} vers la droite, tandis que si nous l'accumulons sur le côté droit, la ligne reste sur le côté gauche. On parle, dans le premier cas, d'un {\em alignement à droite} et, dans le second, d'un {\em alignement à gauche}. Par défaut, \ConTeXt\ applique l'alignement à gauche à la dernière ligne des paragraphes.

Lorsque plusieurs lignes consécutives sont alignées à gauche, le côté droit est irrégulier~; mais lorsque l'alignement est à droite, le côté qui semble irrégulier est le gauche. Pour nommer les options qui alignent l'un ou l'autre côté, \ConTeXt\ ne définit pas le côté où elles sont alignées, mais le côté où elles sont irrégulières. Par conséquent, l'option {\tt flushright} entraîne un alignement à gauche et l'option {\tt flushleft} un alignement à droite. En tant qu'abréviations de {\tt flushright} et {\tt flushleft}, \tex{setupalign} prend également en charge les valeurs {\tt right} et {\tt left}. Mais {\bf attention}~: ici, le sens des mots est trompeur. Même si {\em left} signifie \quotation{left} et {\em right} signifie \quotation{right}, \tex{setupalign[left]} s'aligne à droite et \tex{setupalign[right]} s'aligne à gauche. Au cas où le lecteur se demanderait pourquoi ce commentaire a été fait, il serait utile de citer le wiki \ConTeXt{}~: \quotation{ConTeXt utilise les options flushleft et flushright. Les alignements à droite et à gauche sont inversés par rapport aux directions habituelles dans toutes les commandes qui acceptent une option d'alignement, dans le sens de \quote{ragged left} et \quote{ragged right}. Malheureusement, lorsque Hans a écrit cette partie de ConTeXt pour la première fois, il pensait à l'alignement \quote{ragged right} et \quote{ragged left}, plutôt qu'à \quote{flush left} et \quote{flush right}. Et maintenant qu'il en est ainsi depuis un certain temps, il est impossible de le modifier, car cela romprait la rétrocompatibilité avec tous les documents existants qui l'utilisent.}

Dans les documents préparés pour une impression recto-verso, outre les marges droite et gauche, il existe également des marges intérieure et extérieure. Les valeurs {\tt flushinner} (ou simplement {\tt inner}) et {\tt flushouter}. (ou simplement {\tt outer}) établissent l'alignement correspondant dans ces cas.

\item Le répartir sur les deux marges. Le résultat sera que la ligne est centrée. L'option \tex{setupalign} qui permet de le faire est {\tt middle}.

\item La répartir entre tous les mots qui composent la ligne, si nécessaire en augmentant l'espace entre les mots, afin que la ligne ait exactement la même largeur que l'espace dont elle dispose. Dans ces cas, on parle de {\em lignes justifiées}. C'est également la valeur par défaut de \ConTeXt, c'est pourquoi il n'y a pas d'option spéciale dans \tex{setupalign} pour l'établir. Cependant, si nous avons modifié l'alignement justifié par défaut, nous pouvons le rétablir avec \tex{setupalign[reset]}.

\stopitemize

\placefigure [force,here,none] [] {}{
\startDemoVN
\startalignment [flushleft]
Une phrase pour voir l'impact de l'option d'alignement {\bf \tt flushleft}.
\stopalignment
\startalignment [right]
Une phrase pour voir l'impact de l'option d'alignement {\bf \tt right}.
\stopalignment
\startalignment [flushright]
Une phrase pour voir l'impact de l'option d'alignement {\bf \tt flushright}.
\stopalignment
\startalignment [left]
Une phrase pour voir l'impact de l'option d'alignement {\bf \tt left}.
\stopalignment
\stopDemoVN}

La valeur de \tex{setupalign} que nous venons de voir ({\tt right, flushright, left, flushleft, inner, flushinner, outer, flushouter} et {\tt middle}) peut être combinée avec {\tt broad}, ce qui donne un alignement un peu plus grossier.

\startSmallPrint

Deux autres valeurs possibles de \tex{setupalign} qui affectent l'alignement horizontal, concernent la césure des mots en fin de ligne, car le fait que cela soit fait ou non dépend de la mesure {\em exacte} de la ligne, qui est plus ou moins grande, ce qui affecte l'espace blanc restant.

À cet effet, \tex{setupalign} autorise la valeur {\tt morehyphenation} qui fait travailler \ConTeXt\ plus fort pour trouver des points d'arrêt basés sur la césure, et {\tt lesshyphenation} qui produit l'effet inverse. Avec \tex{setupalign[horizontal, morehyphenation]}, l'espace blanc restant dans les lignes sera réduit et l'alignement sera donc moins apparent. Au contraire, avec \tex{setupalign[horizontal, lesshyphenation]}, il restera plus d'espace blanc, et l'alignement sera plus visible.

\stopSmallPrint

\tex{setupalign} est destiné à être inclus dans le préambule et à affecter tout le document ou à être inclus à un point spécifique et à affecter tout à partir de ce point jusqu'à la fin. Si nous voulons seulement changer l'alignement d'une ou plusieurs lignes, nous pouvons utiliser~:

\startitemize

\item L'environnement \MyKey{alignment}, destiné à affecter plusieurs lignes. Son format général est le suivant, où {\em Options} sont toutes celles autorisées pour \tex{setupalign}~:

\PlaceMacro{startalignment}
\placefigure [force,here,none] [] {}{
\startDemoI
\startalignment [Options] ... \stopalignment
\stopDemoI}


\item \PlaceMacro{leftaligned} \tex{leftaligned}, \PlaceMacro{midaligned} \tex{midaligned} ou \PlaceMacro{rightaligned}. \tex{rightaligned} provoquent respectivement un alignement à gauche, centré ou à droite~; et si nous voulons que le dernier mot d'un paragraphe (mais seulement celui-ci et pas le reste de la ligne) soit aligné à droite, nous pouvons utiliser \PlaceMacro{wordright} \tex{wordright} (voir l'exemple en fin de \in{section}[sec:horizontal space2]). Toutes ces commandes requièrent que le texte à affecter se trouve entre des accolades.

\startSmallPrint

Notez, d'autre part, que si les mots \MyKey{right} et \MyKey{left} dans \tex{setupalign} provoquent l'alignement opposé à ce que le nom suggère, il n'en va pas de même avec les commandes \tex{leftaligned} et \tex{rightaligned} qui provoquent exactement le type d'alignement que leur nom suggère~: {\tt left} à gauche, et {\tt right} à droite.

\stopSmallPrint

\stopitemize

\stopsubsubsection

% *** Subsection
\startsubsubsection
  [
    reference={sec:VerticalAlignment},
    title={Alignement vertical},
  ]

Si l'alignement horizontal intervient lorsque la largeur d'une ligne n'occupe pas tout l'espace disponible, l'alignement vertical concerne la hauteur de toute la page~: si la hauteur {\em exacte} du texte d'une page n'occupe pas toute la hauteur disponible, que fait-on de l'espace blanc restant~? Toujours avec \tex{setupalign} Nous pouvons l'empiler en haut (\MyKey{height}), ce qui signifie que le texte de la page sera poussé vers le bas~; nous pouvons l'empiler en bas (\MyKey{bottom}) ou le répartir entre les paragraphes (\MyKey{line}). La valeur par défaut de l'alignement vertical est \MyKey{bottom}.

\startSmallPrint

L'option \MyKey{height} semble pas fonctionner.

\stopSmallPrint


\startsubsubsubject{Niveau de tolérance en vertical}

De la même manière que nous pouvons modifier le niveau de tolérance de \ConTeXt\ en ce qui concerne la quantité d'espace horizontal autorisée dans une ligne (tolérance horizontale) avec \PlaceMacro{setuptolerance} \tex{setuptolerance}, nous pouvons également modifier sa tolérance verticale, c'est-à-dire la tolérance pour un espace inter-paragraphe plus grand que celui que \ConTeXt\ considère comme raisonnable par défaut pour une page correctement composée. Les valeurs possibles pour la tolérance verticale sont les mêmes que pour la tolérance horizontale~: {\tt verystrict, strict, tolerant} et {\tt verytolerant}. La valeur par défaut est \tex{setuptolerance [vertical, strict]}.

\stopsubsubsubject

\startsubsubsubject{Contrôler les veuves et les orphelins}


Un aspect qui affecte indirectement l'alignement vertical est le contrôle des veuves et des orphelins. Ces deux termes font référence aux lignes de paragraphes unique et isolées du reste du paragraphe à cause d'un saut de page. Ceci n'est pas considéré comme typographiquement approprié. Si la ligne séparée du reste du paragraphe est la première de la page, on parle d'une {\em ligne veuve}~; si la ligne séparée de son paragraphe est la dernière de la page, on parle d'une {\em ligne orpheline}.

% MODIFIED Garulfo 
% from https://mailman.ntg.nl/pipermail/ntg-context/2013/074055.html

Par défaut, \ConTeXt\ n'implémente pas de contrôle pour s'assurer que ces lignes ne se produisent pas. Mais nous pouvons changer cela en modifiant certaines des variables internes de \ConTeXt{}~: \PlaceMacro{widowpenalties} \tex{widowpenalties} contrôle les lignes veuves et \PlaceMacro{clubpenalties} \tex{clubpenalties} contrôle les lignes orphelines. Ainsi, les déclarations suivantes dans le préambule de notre document garantiront que ce contrôle est effectué~:

\PlaceMacro{startsetups}
\PlaceMacro{setdefaultpenalties}

\placefigure [force,here,none] [] {}{
\startDemoI
\startsetups [mypenalties]
\setdefaultpenalties
\setpenalties\widowpenalties{3}{10000} %     3 == nombre de lignes
\setpenalties\clubpenalties {3}{10000} % 10000 == penalité entre les 3 lignes
\stopsetups

\setuplayout[setups=mypenalties]
\stopDemoI}

Par l'exécution de ces commandes \ConTeXt\ évitera d'insérer un saut de page qui sépare les 3 premières ou dernières lignes d'un paragraphe de la page sur laquelle se trouve le reste. Cet évitement sera plus ou moins rigoureux selon la valeur que nous attribuons aux variables. Avec une valeur de 10 000, comme celle que j'ai utilisée dans l'exemple, le contrôle sera absolu~; avec une valeur de 150, par exemple, le contrôle ne sera pas aussi rigoureux et il se peut qu'il y ait parfois quelques lignes veuves ou orphelines lorsque l'alternative est pire en termes typographiques.

\stopsubsubsubject

\stopsubsubsection

\stopsection

% *** Subsection Mise en retrait auto des 1er lignes des paragraphes

\startsection
  [
    reference=sec:indentation,
    title={Mise en retrait automatique des premières lignes des paragraphes},
  ]

Voyons tout d'abord comment l'indentation des lignes et des paragraphes est réalisée avec \ConTeXt.

L'insertion automatique d'un petit retrait à la première ligne des paragraphes est désactivée par défaut. Nous pouvons l'activer, la désactiver à nouveau et, lorsqu'elle est activée, indiquer l'étendue du retrait à l'aide de la commande \PlaceMacro{setupindenting} \tex{setupindenting} qui autorise les valeurs suivantes pour indiquer si le retrait doit être activé ou non~:

\startitemize[packed]

\item {\tt\bf always}~: tous les paragraphes seront indentés, quoi qu'il arrive.

\item {\tt\bf yes}~: active l'indentation des paragraphes {\em normaux}. Certains paragraphes précédés d'un espacement vertical supplémentaire, comme le premier paragraphe des sections, ou les paragraphes suivant certains environnements, ne seront pas mis en retrait.

\item {\tt\bf no, not, never, none}~: désactive le retrait automatique de la première ligne des paragraphes.

\item {\tt\bf first / next}~: active ou désactive le retrait automatique du premier paragraphe d'une section.

\stopitemize

Dans le cas où nous avons activé l'indentation automatique, nous pouvons également indiquer, au moyen de la même commande, la quantité d'indentation à prévoir. Pour ce faire, nous pouvons utiliser expressément une dimension (par exemple 1,5 cm) ou bien les mots symboliques \MyKey{small}, \MyKey{medium} et \MyKey{big} qui indiquent que nous voulons un petit, moyen ou grand retrait.

\placefigure [force,here,none] [] {}{
\startDemoVN
\setupindenting[yes,1em]
Un petit pagragraphe afin de montrer l'effet visuel d'une indentation. Un petit pagragraphe afin de montrer l'effet visuel d'une indentation.

\setupindenting[yes,medium]
Un petit pagragraphe afin de montrer l'effet visuel d'une indentation. Un petit pagragraphe afin de montrer l'effet visuel d'une indentation.

\setupindenting[no,2em]
Un petit pagragraphe afin de montrer l'effet visuel d'une indentation. Un petit pagragraphe afin de montrer l'effet visuel d'une indentation.
\stopDemoVN}


\startSmallPrint

% TODO Garulfo faux c'est-à-dire aussi large que la hauteur de la police (Wikipedia)
% Sans doute à reformuler
% ADel le quad = espace cadratin = largeur de la lettre M ; mais dans le lexique des règles typographiques de l'Imprimerie nationale "En composition typographique, blanc « carré » dont le côté est égal à la force de corps du caractère utilisé." mais en typographie mécanique variable selon la chasse du caractère.

Dans certaines traditions de composition (et notamment en espagnol), l'indentation par défaut était de deux quarts. En typographie, une quad (à l'origine \em{quadrat}) était un espaceur (entretoise) métallique utilisé en typographie. Le terme a ensuite été adopté comme nom générique pour deux tailles d'espacement courantes en typographie, quelle que soit la forme de composition utilisée. Un em quad est un espace d'un em de large, c'est-à-dire aussi large que la lettre M de la police.  Ainsi, dans le cas d'une lettre de 12 points, le quadrilatère aurait une largeur de 12 points et une hauteur de 12 points. \ConTeXt\ possède deux commandes de quadrature~: \tex{quad} qui génère un espace du type mentionné ci-dessus, et \tex{qquad} qui génère deux fois cette quantité, toujours en restant proportionnel à la police utilisée. Un retrait de deux quads avec une lettre de 11 points mesurera 22 points, et avec une lettre de 12 points, 24 points.

\stopSmallPrint

Lorsque l'indentation est activée, si nous ne voulons pas qu'un certain paragraphe soit indenté, nous devons utiliser la commande \PlaceMacro{noindentation} \tex{noindentation}.

\startSmallPrint

En général, j'active l'indentation automatique dans mes documents avec \tex{setupindenting [yes, big]}. Dans ce document, cependant, je ne l'ai pas fait parce que si l'indentation était activée, le grand nombre de phrases courtes et d'exemples donnerait une apparence désordonnée aux pages.

\stopSmallPrint

\stopsection


% **  Subsection formation les paragraphes

\startsection
  [
    reference=sec:lines,
    title={Passage à la ligne et formation des paragraphes},
  ]

L'une des principales tâches d'un système de composition consiste à prendre une longue chaîne de mots et à la diviser en lignes individuelles de la taille appropriée. Par exemple, chaque paragraphe de ce texte a été divisé en lignes de \the\textwidth de large, mais l'auteur n'a pas eu à se soucier de ces détails, car \ConTeXt\ choisit les points d'arrêt après avoir considéré chaque paragraphe dans son intégralité, de sorte que les derniers mots d'un paragraphe peuvent réellement influencer la division de la première ligne. Par conséquent, l'espace entre les mots de l'ensemble du paragraphe est aussi uniforme que possible.


\startSmallPrint

C'est l'un des aspects où l'on peut le mieux constater la différence de fonctionnement des traitements de texte et la meilleure qualité obtenue avec des systèmes tels que \ConTeXt. En effet, un traitement de texte, lorsqu'il atteint la fin de la ligne et passe à la suivante, ajuste l'espace blanc de la ligne qui vient de se terminer pour permettre la justification à droite. Il fait cela pour chaque ligne, et à la fin, chaque ligne du paragraphe aura un espacement différent entre les mots.   Cela peut produire un très mauvais effet (par exemple, une {\em rivière} d'espaces blancs qui traverse le texte). \ConTeXt, en revanche, traite le paragraphe dans son intégralité et calcule pour chaque ligne le nombre de points d'arrêt admissibles et la quantité d'espacement entre les mots qui résulterait d'un saut de ligne. Comme le point de rupture d'une ligne affecte les points de rupture potentiels des lignes suivantes, le nombre total de possibilités peut être très élevé~; mais ce n'est pas un problème pour \ConTeXt.   Il prendra une décision finale en se basant sur l'ensemble du paragraphe, en s'assurant que l'espace entre les mots de chaque ligne est {\em aussi similaire que possible}, ce qui donne des paragraphes bien mieux composés, visuellement plus compacts.

\stopSmallPrint

Pour ce faire, \ConTeXt\ teste différentes alternatives, et attribue une valeur de {\em mauvais goût (badness)} à chacune d'entre elles en fonction de ses paramètres. Ceux-ci ont été établis après une étude approfondie de l'art de la typographie. Enfin, après avoir exploré toutes les possibilités, \ConTeXt\ choisit l'option la moins inadaptée (celle qui a la plus petite valeur de mauvais goût). En général, cela fonctionne assez bien, mais il y aura inévitablement des cas où l'on choisira des points de rupture de ligne qui ne sont pas les meilleurs, ou qui ne nous paraissent pas être les meilleurs. Par conséquent, nous voudrons parfois indiquer au programme que certains endroits ne sont pas de bons points d'arrêt. En d'autres occasions, nous voudrons forcer une rupture à un point particulier.

% *** Subsection
\startsubsubsection
  [
    reference=sec:lettertilde,
    title={Utilisation du caractère réservé \quote{\tt\lettertilde}},
  ]

Les principaux candidats pour les sauts de ligne sont évidemment les espaces blancs entre les mots. Pour indiquer qu'un certain espace ne doit jamais être remplacé par un saut de ligne, nous utilisons, comme nous le savons déjà, le caractère réservé \quote{\lettertilde}, que \TeX\ appelle une {\em attache (tie)}, liant deux mots ensemble.

Il est généralement recommandé d'utiliser cet espace insécable dans les cas suivants~:


\startitemize[packed]

\item Entre les parties qui composent une abréviation. Par exemple, {\tt U\lettertilde S}.

\item entre les abréviations et le terme auquel elles se réfèrent. Par exemple, {\tt Dr\lettertilde Anne Ruben} ou {\tt p.\lettertilde 45}.

\item Entre les chiffres et le terme qui les accompagne. Par exemple, {\tt Élizabeth\lettertilde II}, {\tt 45\lettertilde volumes}.

\item Entre les chiffres et les symboles qui les précèdent ou les suivent, à condition qu'ils ne soient pas en exposant. Par exemple, {\tt 73\lettertilde km}, {\tt \$\lettertilde 53}~; cependant, {\tt 35'}.

\item En pourcentages exprimés en mots. Par exemple, {\tt trente\lettertilde pour\lettertilde cent}.

\item Dans les groupes de chiffres séparés par un espace blanc. Par exemple, {\tt 5\lettertilde 357\lettertilde 891}. Bien que dans ces cas, il soit préférable d'utiliser ce que l'on appelle l'espacement fin, obtenu dans \ConTeXt\ avec la commande \tex{,}, et donc d'écrire {\tt 5\backslash,357\backslash,891}.

  \item Pour éviter qu'une abréviation soit le seul élément de cette ligne. Par exemple~:

\placefigure [force,here,none] [] {}{
\startDemoI
Il existe des secteurs tels que le divertissement, les médias de communication,  le commerce,~etc.
\stopDemoI}

% En typographie française on ajoute une espace devant les ponctuations double (; : ? !) et à l'intérieur des guillemets («  »)~; pour éviter ques ces ponctuations ne se retrouvent en début de ligne, suite à une coupure mal placée, on les précède du \quote{\lettertilde}. Par exemple~: {\tt texte\lettertilde ;}.

\stopitemize

À ces cas, {\sc Knuth} (le père de \TeX) ajoute les suivantes recommandations~:

\startitemize[packed]

\item Après une abréviation qui ne se trouve pas à la fin d'une phrase.

  \item En référence aux parties d'un document telles que les chapitres, les annexes, les figures, etc. Par exemple~: {\tt Chapitre\lettertilde 12}.

  \item Entre le prénom et l'initiale du second nom d'une personne, ou entre l'initiale du prénom et le nom de famille. Par exemple, {\tt Donald\lettertilde E. Knuth}, {\tt A.\lettertilde Einstein}. % peut-être {\tt Donald\lettertilde E.\lettertilde Knuth} ??

  \item Entre les symboles mathématiques en apposition aux noms. Par exemple, {\tt dimension\lettertilde \$d\$}, {\tt width\lettertilde \$w\$}.

  \item Entre des symboles en série. Par exemple~: {\tt \{1,\lettertilde 2, \backslash dots,\lettertilde \$n\$\}}.

  \item Quand un nombre est strictement lié à une préposition. Par exemple~: {\tt de 0 à\lettertilde 1}.

  \item Lorsque des symboles mathématiques sont exprimés par des mots. Par exemple, {\tt égale\lettertilde à\lettertilde \$n\$}.

  \item Dans les listes à l'intérieur d'un paragraphe. Par exemple~: {\tt (1)\lettertilde vert, (2)\lettertilde rouge, (3)\lettertilde bleu}.


\stopitemize

De nombreux cas~? Sans aucun doute, la perfection typographique a un coût en termes d'efforts supplémentaires. Il est clair que si nous ne le voulons pas, nous ne sommes pas obligés d'appliquer ces règles, mais cela ne fait pas de mal de les connaître. En outre, et je parle ici d'expérience, une fois que nous nous sommes habitués à les appliquer (ou à n'importe laquelle d'entre elles), cela devient automatique. C'est comme mettre des accents sur les mots lorsque nous les écrivons (comme nous devons le faire en français)~: pour ceux d'entre nous qui le font, si nous sommes habitués à les écrire automatiquement, il ne nous faut pas plus de temps pour écrire un mot avec un accent que pour un mot sans accent.

\stopsubsubsection

% *** Subsection
\startsubsubsection
  [title=La césure des mots]

Sauf pour les langues composées principalement de monosyllabes, il est assez difficile d'obtenir un résultat optimal si les sauts de ligne se trouvent uniquement au niveau des espaces entre les mots. C'est pourquoi \ConTeXt\ analyse également la possibilité d'insérer un saut de ligne entre deux syllabes d'un mot~; et pour ce faire, il est essentiel qu'il connaisse la langue du texte, puisque les règles de césure sont différentes pour chaque langue. D'où l'importance de la commande \tex{mainlanguage} dans le préambule du document.

\PlaceMacro{mainlanguage}

Il peut arriver que \ConTeXt\ soit incapable de couper un mot de manière appropriée. Cela peut être dû à ses propres règles de division des mots (par exemple, \ConTeXt\ ne divise jamais un mot en deux parties si ces parties n'ont pas un nombre minimum de lettres) ou à l'ambiguïté du mot. Par exemple, le mot malaise se coupe en \quotation{mal-aise} s’il s’agit du nom masculin qui désigne un état de désagrément ou de gêne passagère, mais en \quotation{ma-laise} s’il s’agit du nom féminin ou de l’adjectif relatif à la Malaisie. 

Quelle que soit la raison, si nous ne sommes pas satisfaits de la façon dont un mot a été scindé, ou s'il est incorrect, nous pouvons le modifier en indiquant expressément les points potentiels où un mot peut être scindé avec le symbole de contrôle \tex{-}. Ainsi, par exemple, si \quotation{malaise} nous posait problème, nous pourrions l'écrire dans le fichier source sous la forme \MyKey{mal\backslash-aise} ou \MyKey{ma\backslash-laise}.

Si le mot problématique est utilisé plusieurs fois dans notre document, il est préférable d'indiquer la manière dont il doit être séparé par un trait d'union dans notre préambule à l'aide de la commande \PlaceMacro{hyphénation} \tex{hyphénation}~: cette commande, qui est destinée à être incluse dans le préambule du fichier source, prend un ou plusieurs mots (séparés par des virgules) comme argument, indiquant les points auxquels ils peuvent être séparés par un trait d'union. Par exemple~:

\placefigure [force,here,none] [] {}{
\startDemoI
\hyphenation{mal-aise, roudou-dou}
\stopDemoI}

% TODO Garulfo redite à simplifier

Si le mot qui fait l'objet de cette commande ne contient pas de trait d'union, l'effet sera que le mot ne sera jamais ciselé. Ce même effet peut être obtenu en utilisant la commande \PlaceMacro{hbox} \tex{hbox} qui crée une boîte horizontale indivisible autour du mot, ou la commande \PlaceMacro{unhyphenated} \tex{unhyphenated} qui empêche la césure du ou des mots qu'elle prend comme arguments. Mais alors que \tex{hyphenation} agit globalement, \tex{hbox} et \tex{unhyphenated} agissent localement, ce qui signifie que la commande \tex{hyphenation} affecte toutes les occurrences dans le document des mots inclus dans son argument, contrairement à \tex{hbox} ou \tex{unhyphenated} qui n'agissent qu'à l'endroit du fichier source où ils sont rencontrés.

\startSmallPrint

En interne, le fonctionnement de la césure est contrôlé par les paramètres \TeX\ \PlaceMacro{pretolerance} \tex{pretolerance} et \PlaceMacro{tolerance} \tex{tolerance}. La première de ces variables contrôle l'admissibilité d'une division effectuée uniquement sur un espace blanc. Par défaut, elle est égale à 100, mais si nous la modifions, par exemple, pour la porter à 10\,000, alors \ConTeXt\ considérera toujours qu'il est acceptable qu'il y ait un saut de ligne qui n'implique pas la séparation des mots en fonction des syllabes, ce qui signifie que {\em de facto}, nous supprimons la césure basée sur les syllabes. Alors que si, par exemple, nous fixions la valeur de \tex{pretolerance} à -1, nous obligerions \ConTeXt\ à utiliser la césure des mots en fin de ligne à chaque fois.

Nous pouvons directement définir une valeur arbitraire pour \tex{pretolerance} en lui attribuant simplement une valeur dans notre document. Par exemple~:

\placefigure [force,here,none] [] {}{
\startDemoI
\pretolerance=10000
\stopDemoI}

Nous pouvons également manipuler cette valeur avec les valeurs \MyKey{lesshyphenation} et \MyKey{morehyphenation} dans \tex{setupalign}. Voir à ce sujet la section \in{section} [sec:setupalign].

\stopSmallPrint

\stopsubsubsection

% *** Subsection
\startsubsubsection
  [
    reference=sec:horizontaltolerance,
    title={Niveau de tolérance pour les sauts de ligne},
  ]

Lorsqu'il recherche les points de retour à la ligne possibles, \ConTeXt\ est généralement assez strict, ce qui signifie qu'il préfère permettre à un mot de dépasser la marge de droite parce qu'il n'a pas pu y placer de césure, et préfère ne pas insérer de retour à la ligne avant le mot si cela entraîne une augmentation trop importante de l'espace inter-mots sur cette ligne. Ce comportement par défaut donne normalement des résultats optimaux, et ce n'est qu'exceptionnellement que certaines lignes ressortent quelque peu sur la droite. L'idée est que l'auteur (ou le compositeur) examine ces cas exceptionnels une fois le document terminé, pour prendre la décision appropriée, qui pourrait être une commande \tex{break} devant le mot qui s'étend au-delà, ou pourrait également signifier une formulation différente du paragraphe afin que ce mot change de position.

Cependant, dans certains cas, la faible tolérance de \ConTeXt\ peut être un problème. Dans ces cas, nous pouvons lui demander d'être plus tolérant avec les espaces blancs dans les lignes. Nous disposons pour cela de la commande \PlaceMacro{setuptolerance} \tex{setuptolerance}, qui nous permet de modifier le niveau de tolérance dans le calcul des sauts de ligne, que \ConTeXt\ appelle \quotation{tolérance horizontale} (car elle affecte l'espace horizontal) et \quotation{tolérance verticale} lors du calcul des sauts de page. Nous en parlerons dans la \in{section} [sec:VerticalAlignment].

La tolérance horizontale (qui est celle qui affecte les sauts de ligne), est fixée à la valeur \MyKey{verystrict} par défaut. Nous pouvons modifier cela en définissant, comme alternatives, l'une des valeurs suivantes~: \MyKey{strict}, \MyKey{tolerant}, \MyKey{verytolerant} ou \MyKey{stretch}. Ainsi, par exemple,
\MyKey{verytolerant} rendra presque impossible le dépassement de la marge de droite par une ligne, quitte à établir un espacement très important et inesthétique entre les mots d'une ligne.


\startbuffer[testtolerance]
Pour en revenir à l'utilisation des caractères dans l'édition électronique, bon nombre de nouveaux typographes tirent leurs connaissances et leurs informations sur les règles de la typographie des livres, des magazines informatiques ou des manuels d'instruction qu'ils reçoivent à l'achat d'un PC ou d'un logiciel. 
\stopbuffer

{\bf Exemple avec \MyKey{verytolerant}}
{\startcolumns[n=3]\tfa
\setuptolerance [horizontal,verytolerant]%
\getbuffer[testtolerance]
\stopcolumns}

{\bf Exemple avec \MyKey{verystrict}}
{\startcolumns[n=3]\tfa
\setuptolerance [horizontal,verystrict]%
\getbuffer[testtolerance]
\stopcolumns}


\stopsubsubsection

% *** Subsection
\startsubsubsection
  [title={Forcer un saut de ligne à un certain point}]

Pour forcer un retour à la ligne à un certain point, nous utilisons les fonctions \PlaceMacro{break} \tex{break}, \PlaceMacro{crlf} \tex{crlf} ou \PlaceMacro{\backslash} {\tt\backslash\backslash}. La première d'entre elles, \tex{break}, introduit un saut de ligne à l'endroit où elle se trouve. Cela entraînera très probablement une déformation esthétique de la ligne où la commande est placée, avec une immense quantité d'espace blanc entre les mots de cette ligne. Comme on peut le voir dans l'exemple suivant, où la commande \tex{break} dans la troisième ligne (du fragment source à gauche) donne lieu à une deuxième ligne assez laide (dans le texte formaté à droite).


\placefigure [force,here,none] [] {}{
\startDemoVN
Au coin du vieux quartier, je 
l'ai vu \emph{se pavaner} comme
le font\break les gros bras quand
ils marchent, les mains toujours
dans les poches de leur pardessus,
pour que personne ne puisse savoir
lequel d'entre eux porte le poignard.
\stopDemoVN}



Pour éviter cet effet, nous pouvons utiliser les commandes \cmd{\backslash} ou \tex{crlf} qui insèrent également un saut de ligne forcé, mais elles remplissent la ligne d'origine avec suffisamment d'espace vide pour l'aligner à gauche~:


\placefigure [force,here,none] [] {}{
\startDemoVN
Au coin du vieux quartier, je 
l'ai vu \emph{se pavaner} comme
le font\\ les gros bras quand
ils marchent, les mains toujours
dans les poches de leur pardessus,
pour que personne ne puisse savoir
lequel d'entre eux porte le poignard.
\stopDemoVN}

Sur les lignes {\em normales}, pour autant que je sache, il n'y a pas de différence entre \cmd{\backslash} et \tex{crlf}~; mais dans un titre de section, il y a une différence~:


\startitemize

\item {\tt\bf\backslash\backslash} génère un saut de ligne dans le corps du document, mais pas lorsque le titre de la section est transféré dans la table des matières.

\item {\bf\tex{crlf}} génère un retour à la ligne qui s'applique à la fois dans le corps du document et lorsque le titre de la section est transféré dans la table des matières.

\stopitemize

Un saut de ligne ne doit pas être confondu avec un saut de paragraphe. Un saut de ligne met simplement fin à la ligne en cours et commence la ligne suivante, mais nous maintient dans le même paragraphe, de sorte que la séparation entre la ligne d'origine et la nouvelle ligne sera déterminée par l'espacement normal dans un paragraphe. Par conséquent, il n'y a que trois scénarios dans lesquels il peut être recommandé de forcer un saut de ligne~:

\startitemize

\item Dans des cas très exceptionnels, lorsque \ConTeXt\ n'a pas été en mesure de trouver un saut de ligne approprié, de sorte qu'une ligne dépasse sur la droite. Dans ces cas (qui se produisent très rarement, principalement lorsque la ligne contient des {\em boîtes} indivisibles, ou du texte {\em verbatim} [voir \in{section}[sec:verbatim]]), il peut être utile de forcer un saut de ligne avec \tex{break} juste avant le mot qui dépasse dans la marge de droite.

\item Dans les paragraphes qui sont en fait composés de lignes individuelles, chacune contenant des informations indépendantes de celles des lignes précédentes, par exemple, l'en-tête d'une lettre dans laquelle la première ligne peut contenir le nom de l'expéditeur, la deuxième le destinataire et la troisième la date~; ou dans un texte parlant de la paternité d'une œuvre, où une ligne contient le nom de l'auteur, une autre sa fonction ou sa position académique et peut-être une troisième ligne avec la date, etc. Dans ces cas, le saut de ligne doit être forcé avec les commandes \cmd{\backslash} ou \tex{crlf}. Il est également courant que ce type de paragraphe soit aligné à droite.

\item Lors de la rédaction de poèmes ou d'autres types de textes similaires, pour séparer un vers d'un autre. Bien que dans ce dernier cas, il soit préférable d'utiliser l'environnement {\tt lines} expliqué dans \in{section}[sec:startlines].

\stopitemize

\stopsubsubsection

\stopsection



\stopchapter

%==============================================================================

\stopcomponent

%%% TeX-master: "../introCTX_fra.tex"
