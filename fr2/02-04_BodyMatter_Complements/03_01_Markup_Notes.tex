\startcomponent 02-02-02-02_Markup_Notes

\environment introCTX_env_00

%==============================================================================

\startsection
  [title=Notes de bas de page,
  reference=sec:mkp:notes]

  
\TocChap


\tex{footnote}
\tex{placefootnotes}

\tex{endnote}

\tex{startlocalfootnotes}
\tex{placelocalfootnotes}

\tex{definenote}
\tex{placenotes}


Les notes sont des \quotation{éléments textuels secondaires employés à des fins diverses, comme clarifier ou prolonger le texte principal, fournir la référence bibliographique des sources, y compris les citations, renvoyer à d'autres documents ou énoncer le sens du texte}. [{\em Libro de Estilo de la Lengua española} (Guide de style de la langue espagnole), p. 195]. Elles sont particulièrement importantes dans les textes de nature académique. Elles peuvent être placés à différents endroits de la page ou du document. Aujourd'hui, les plus répandues sont celles qui sont situées en bas de page (appelées, par conséquent, notes de bas de page)~; parfois, elles sont également situées dans l'une des marges (notes de marge), à la fin de chaque chapitre ou section, ou à la fin du document (notes de fin de document). Dans les documents particulièrement complexes, il peut également y avoir différentes séries de notes~: notes de l'auteur, notes du traducteur, mises à jour, etc. En particulier, dans les éditions critiques, l'appareil de notes peut devenir assez complexe et seuls quelques systèmes de composition sont capables de le supporter. \ConTeXt\ est l'un d'entre eux. De nombreuses commandes sont disponibles pour établir et configurer les différents types de notes. 

Pour expliquer cela, il est utile de commencer par indiquer les différents éléments qui peuvent être impliqués dans une note~:


\startitemize

\item {\em Marque} ou note {\em ancre}~: Signe placé dans le corps du texte pour indiquer qu'une note lui est associée. Tous les types de notes ne sont pas associés à une {\em ancre}, mais lorsqu'il y en a une, cette {\em ancre} apparaît à deux endroits~: à l'endroit du texte principal auquel la note fait référence, et au début du texte de la note elle-même. C'est la présence de la même marque de référence à ces deux endroits qui permet d'associer la note au texte principal.

\item La note {\em ID ou identifiant}~: La lettre, le chiffre ou le symbole qui identifie la note et la distingue des autres notes. Certaines notes, par exemple les notes de marge, peuvent ne pas avoir d'ID. Lorsque ce n'est pas le cas, l'identifiant coïncide normalement avec l'{\em ancre} de la note.

\startSmallPrint

Si nous pensons exclusivement aux notes de bas de page, nous ne verrons aucune différence entre ce que je viens d'appeler une {\em Marque} et l’{\em id}. Nous voyons clairement la différence dans d'autres types de notes~: Les notes de ligne, par exemple, ont un id, mais pas de marque de référence.
    
\stopSmallPrint


\item {\em Texte} ou {\em Contenu} de la note, toujours situé à un endroit différent sur la page ou dans le document que la commande qui génère la note et indique son contenu.

\item {\em Étiquette} associée à la note~: Étiquette ou nom associé à une note qui n'apparaît pas dans le document final, mais qui permet d'y faire référence et de retrouver son identifiant ailleurs dans le document.

\stopitemize

% *** Subsection 
\startsubsection
  [title=Les types de notes dans \ConTeXt\ et les commandes associées]

Nous disposons de différents types de notes dans \ConTeXt. Pour l'instant, je me contenterai de les énumérer, en les décrivant en termes généraux et en fournissant des informations sur les commandes qui les génèrent. Plus tard, je développerai les deux premiers~:


\startitemize

\item {\bf Notes de bas de page (footnotes)~:} Sans aucun doute la plus populaire, à tel point qu'il est courant que tous les types de notes soient désignés par le terme générique de {\em notes de bas de page}. Les notes de bas de page introduisent une {\em marque} avec l'{\em id} de la note à l'endroit du document où se trouve la commande, et insèrent le texte de la note elle-même en bas de la page où la marque apparaît. Elles sont créées avec la commande \tex{footnote}.

\item {\bf Notes de fin de document (endnotes)~:} Ces notes, créées avec la commande \tex{endnote}, sont insérées à l'endroit du document où se trouve une marque portant l'identifiant de la note~; mais le contenu de la note est inséré à un autre endroit du document, et l'insertion est produite par une commande différente (\tex{placenotes}).

\item {\bf Notes marginales (margin notes)~:} Comme leur nom l'indique, elles sont écrites dans la marge du texte et il n'y a pas d'identifiant ou de marque ou d'ancre générée automatiquement dans le corps du document. Les deux principales commandes (mais pas les seules) qui les créent sont \tex{inmargin} et \tex{margintext} (voir \in{section}[sec:margintext]).

\item {\bf Notes de ligne (line notes)~:} Type de note typique des environnements où les lignes sont numérotées, comme dans le cas de \tex{startlinenumbering ... \stoplinenumbering} (voir \in{section}[sec:linumbering]). La note, qui est généralement écrite en bas, fait référence à un numéro de ligne spécifique. Elles sont générées par la commande \PlaceMacro{linenote} \tex{linenote} qui est configurée avec \PlaceMacro{setuplinenote} \tex{setuplinenote}. Cette commande n'imprime pas de {\em marque} dans le corps du texte, mais dans la note elle-même, elle imprime le numéro de ligne auquel la note se réfère (utilisé comme {\em ID}).

\stopitemize

Je vais maintenant développer exclusivement les deux premiers types de notes~:

\startitemize

\item Les notes de marge sont traitées ailleurs (\in{section}[sec:margintext]).

\item Les notes de ligne ont un usage très spécialisé (notamment dans les éditions critiques) et je pense que dans un document d'introduction comme celui-ci, il suffit que le lecteur sache qu'elles existent.

\startSmallPrint

Cependant, pour le lecteur intéressé, je recommande une vidéo (en espagnol) accompagnée d'un texte (également en espagnol) sur les éditions critiques dans \ConTeXt, dont l'auteur est Pablo Rodríguez. Elle est disponible \goto{en ligne}[url(http://www.ediciones-criticas.tk/)]. Elle est également très utile pour comprendre plusieurs des paramètres généraux des notes en général.

\stopSmallPrint

\stopitemize

\stopsubsection

% *** Subsection 
\startsubsection
  [title=Zoom les notes de bas de page et de fin de document]

\PlaceMacro{footnote}
\PlaceMacro{endnote}

La syntaxe des commandes \tex{footnotes} et \tex{endnotes} et les mécanismes de configuration et de personnalisation dont elles disposent sont assez similaires, puisque, en réalité, ces deux types de notes sont des instances particulières d'une construction plus générale (notes), dont d'autres instances peuvent être définies avec la commande \tex{definenote} (voir \in{section}[sec:definenote]).

La syntaxe de la commande qui crée chacun de ces types de notes est la suivante~:

\placefigure [force,here,none] [] {}
{\startDemoI
\footnote [Étiquette] {Texte}
\endnote  [Étiquette] {Texte}
\stopDemoI}

\startitemize

\item {\em Étiquette} est un argument facultatif qui attribue à la note une étiquette qui nous permettra d'y faire référence ailleurs dans le document.

\item {\em Texte} est le contenu de la note. Il peut être aussi long que nous le souhaitons, et inclure des paragraphes et des paramètres spéciaux, bien qu'il faille noter qu'en ce qui concerne les notes de bas de page, une mise en page correcte est assez difficile dans les documents contenant des notes abondantes et excessivement longues.

\startSmallPrint

En principe, toute commande qui peut être utilisée dans le texte principal peut être utilisée dans le texte de la note. Cependant, j'ai pu vérifier que certaines constructions et caractères qui ne posent aucun problème dans le texte principal, génèrent une erreur de compilation lorsqu'ils sont utilisés dans le texte de la note. J'ai trouvé ces cas lors de mes tests, mais je ne les ai pas organisés de quelque manière que ce soit.

\stopSmallPrint

\stopitemize

Lorsque l'argument {\em Étiquette} a été utilisé pour définir une étiquette pour la note, la commande \PlaceMacro{note} \tex{note} nous permet de récupérer l'ID de la note en question. Cette commande affiche l'ID de la note associée à l'étiquette qu'elle prend en argument sur le document. Ainsi, par exemple~:


\placefigure [force,here,none] [] {}
{\startDemoI
\setuppapersize[A7,landscape]
\setupbodyfont[8pt]
\starttext
Humpty Dumpty{\footnote[humpty]{probablement le personnage de comptine anglais le plus célèbre} s'est assis sur un mur, Humpty Dumpty\note[humpty] a fait une grande chute. Tous les chevaux du roi et tous les hommes du roi n'ont pas pu remettre Humpty\note[humpty] ensemble.
\stoptext
\stopDemoI}


\startbuffer[a7-testfootnoteA]
\setuppapersize[A7,landscape]
\setupbodyfont[8pt]
\starttext
Humpty Dumpty{\footnote[humpty]{probablement le personnage de comptine anglais le plus célèbre} s'est assis sur un mur, Humpty Dumpty\note[humpty] a fait une grande chute. Tous les chevaux du roi et tous les hommes du roi n'ont pas pu remettre Humpty\note[humpty] ensemble.
\stoptext
\stopbuffer

\savebuffer[list=a7-testfootnoteA,file=ex_footnoteA.tex,prefix=no]
\placefigure [force,here,none] [] {}{\typesetbuffer[a7-testfootnoteA][frame=on,page=1,background=color,backgroundcolor=white]
\attachment
  [file={ex_footnoteA.tex},
   title={exemple testfootnoteA}]}

La principale différence entre \tex{footnote} et \tex{endnote} est l'endroit où la note apparaît~:


\startdescription{\tex{footnote}}

En règle générale, il imprime le texte de la note au bas de la page sur laquelle se trouve la commande, de sorte que la marque de la note et son texte (ou le début du texte, s'il doit être réparti sur deux pages) apparaissent sur la même page. Pour ce faire, \ConTeXt\ fera les ajustements nécessaires lors de la composition de la page en calculant l'espace requis par l'emplacement de la note au bas de la page.

\startSmallPrint

% TODO Garulfo~: ce n'est pas ainsi que cela fonctionne
% footnotetext c'est comme footnote, sans afficher la marque

% Mais dans certains environnements, \tex{footnote} insérera le texte de la note, non pas en bas de la page elle-même mais sous l'environnement. C'est le cas, par exemple dans l'environnement {\tt columns}. Dans ces cas, si nous voulons que les notes à l'intérieur de l'environnement soient situées en bas de la page, au lieu de \tex{footnote}, la commande que nous devons utiliser est \tex{footnotetext} en combinaison avec la commande \tex{note} mentionnée ci-dessus. La première, qui prend également en charge une étiquette comme argument facultatif, imprime uniquement le texte de la note et non la marque. Mais comme \tex{note} n'imprime que la marque sans le texte, la combinaison des deux nous permet de placer la note à l'endroit voulu. Ainsi, par exemple, nous pouvons écrire \tex{note[MonÉtiquette]} dans un tableau ou un environnement à plusieurs colonnes, puis, une fois sorti de cet environnement, \type{\footnotetext[MonÉtiquette]{texte de la note}}.

\PlaceMacro{footnotetext}
\PlaceMacro{note}

\tex{footnotetext} fait la même chose que \tex{footnote} mais sans introduire la marque localement. La marque peut-être affichée séparément avec \tex{note}, il faut pour cela passer aux deux commandes le nom de référence entre crochet \MyKey{\[MonÉtiquette\]}. Une utilisation de \tex{footnotetext} en combinaison avec \tex{note} serait des notes à l'intérieur d'autres notes. C'est ainsi qu'a été construit la référence 3 dans l'exemple suivant, où vous pouvez constater que dans un environnement \tex{startcolumns} les notes de bas de page deviennent des notes de bas de colonne~:

%-----------------------------------------

\startbuffer[a7-testfootnoteC]
\setuppapersize[A7,landscape]
\setupbodyfont[8pt]
\starttext
\startcolumns[n=2]
Une première phrase pour servir d'exemple
\footnote{Coucou 1}
\column
Une seconde phrase pour servir d'exemple
\footnote{Coucou 2} 
\footnotetext[testici]{Coucou 3} 
\note[testici]
\stopcolumns
\stoptext
\stopbuffer

\savebuffer[list=a7-testfootnoteC,file=ex_footnoteC.tex,prefix=no]
\placefigure [force,here,none] [] {}{\typesetbuffer[a7-testfootnoteC][frame=on,page=1,background=color,backgroundcolor=white]
\attachment
  [file={ex_footnoteC.tex},
   title={exemple testfootnoteC}]}

%-----------------------------------------

\placefigure [force,here,none] [] {}
{\startDemoI
Une seconde phrase pour servir d'exemple
\footnote{Coucou 2} 
\footnotetext[testici]{Coucou 3} 
\note[testici]
\stopDemoI}



\stopSmallPrint
  
\stopdescription

\startdescription{\tex{endnote}}

imprime uniquement l'ancre de la note à l'endroit du fichier source où elle se trouve. Le contenu réel de la note est inséré à un autre endroit du document à l'aide d'une autre commande, (\PlaceMacro{placenotes} \tex{placenotes[endnote]}) qui, à l'endroit où elle se trouve, insère le contenu de {\em toutes} les notes de fin de document (ou du chapitre ou de la section en question).

\stopdescription

\stopsubsection

% *** Subsection 
\startsubsection
  [
    reference=sec:localfootnotes,
    title={Notes locales},
  ]

\PlaceMacro{startlocalfootnotes} 
\PlaceMacro{placelocalfootnotes}

L'environnement \tex{startlocalfootnotes} signifie que les notes de bas de page qui y sont incluses sont considérées comme des notes {\em locales}, ce qui signifie que leur numérotation sera réinitialisée et que le contenu des notes ne sera pas automatiquement inséré avec le reste des notes, mais seulement à l'endroit du document où se trouvera la commande \tex{placelocalfootnotes}, qui peut ou non se trouver dans l'environnement.

%-----------------------------------------

\startbuffer[a7-testfootnoteB]
\setuppapersize[A7,landscape]
\setupbodyfont[8pt]
\starttext
Ceci 
\footnote{ou cela \note[noteB], si vous préférez.}%
\footnotetext[noteB]
{ou encore possiblement celle-ci \note[noteC].}
\footnotetext[noteC]{pourrait être totalement différentes.}
est une phrase avec des notes imbriquées.

\placetable{Table hors localfootnotes}
{\bTABLE[width=0.25\textwidth]
\bTR \bTD Petit A   \eTD \bTD Petit B\footnote{coucou B} \eTD \eTR
\eTABLE}

\placetable{Table encadrée par localfootnotes}
{\startlocalfootnotes
\bTABLE[width=0.25\textwidth]
\bTR \bTD Petit C   \eTD \bTD Petit D\footnote{coucou D} \eTD \eTR
\bTR \bTD[nc=2,frame=off] \placelocalfootnotes           \eTD \eTR
\eTABLE
\stoplocalfootnotes}
\stoptext
\stopbuffer

\savebuffer[list=a7-testfootnoteB,file=ex_footnoteB.tex,prefix=no]
\placefigure [force,here,none] [] {}{\typesetbuffer[a7-testfootnoteB][frame=on,page=1,background=color,backgroundcolor=white]
\attachment
  [file={ex_footnoteB.tex},
   title={exemple testfootnoteB}]}

\placefigure [force,here,none] [] {}
{\startDemoI
\placetable{Table encadrée par localfootnotes}
{\startlocalfootnotes
\bTABLE[width=0.25\textwidth]
\bTR \bTD Petit C   \eTD \bTD Petit D\footnote{coucou D} \eTD \eTR
\bTR \bTD[nc=2,frame=off] \placelocalfootnotes           \eTD \eTR
\eTABLE
\stoplocalfootnotes}
\stopDemoI}

\stopsubsection

% *** Subsection 
\startsubsection
  [
    reference=sec:definenote,
    title={Création et utilisation de types de notes personnalisées},
  ]
  \PlaceMacro{definenote}

Nous pouvons créer des types spéciaux de notes avec la commande \tex{definenote}. Cela peut être utile dans les documents complexes où il y a des notes de différents auteurs, ou à des fins différentes, pour distinguer graphiquement chacun des types de notes dans notre document au moyen d'un format différent et d'une numérotation différente.

La syntaxe de la commande \tex{definenote} est la suivante~:

\placefigure [force,here,none] [] {}
{\startDemoI
\definenote[MesNotes][Modèle][Configuration]
\stopDemoI}

\stopsubsection


\stopsection

%==============================================================================

\stopcomponent

%%% TeX-master: "../introCTX_fra.tex"
