
%------------------------------------------------------------------------------

\startsectionblockenvironment[bodypart]


\setuphead[part][header=empty,footer=empty]

% https://wiki.contextgarden.net/Command/setuphead#Modifying_the_page_before_a_chapter

\setuphead
    [chapter]
    [after={\strut\blank[3*big]},
     header=empty,
     footer=empty]

\setupfootertexts[text]                                                 % sides
    [{\framed[height=max,
             frame=off,
             offset=0pt,
              width=0.4\textwidth,
             location=top,
             strut=yes,
             align={high,flushleft}]
     {\tfx\getmarking[section]}}]
    [{\tfx\cap{\getmarking[chapter]}}]
    [{\tfx\cap{\getmarking[chapter]}}]
    [{\framed[height=max,
              frame=off,
              offset=0pt,
              width=0.4\textwidth,
              location=top,
             strut=yes,
              align={high,flushright}]
     {\tfx\getmarking[section]}}]

\setupfootertexts[margin]                                                 % sides
    []
    [\hfill{\tfx\bf\pagenumber}]
    [{\tfx\bf\pagenumber}\hfill]
    []

 
\setupbottomtexts[text]                                                 % sides
    []
    [{\tfx \in{Table des matières ~ \triangleright}[sec:thetoc]}]
    [{\tfx \in{\triangleleft ~ Table des matières}[sec:thetoc]}]
    []

\stopsectionblockenvironment

%------------------------------------------------------------------------------


\startsectionblockenvironment[frontpart]

\setuphead[part][header=empty,footer=empty]

\setuphead
    [chapter]
    [after={\strut\blank[3*big]},
     header=empty,footer=empty]

\setupfootertexts[text]                                                 % sides
    []
    [{\framed[height=max,frame=off,offset=0pt,
             strut=yes,
              width=0.4\textwidth,location=top,align={high,flushright}]{\tfx\cap{\getmarking[chapter]}}}]
    [{\framed[height=max,frame=off,offset=0pt,
             strut=yes,
              width=0.4\textwidth,location=top,align={high,flushleft}] {\tfx\cap{\getmarking[chapter]}}}]
    []


  \setupfootertexts[margin]                                                 % sides
    []
    [\hfill{\tfx\bf\pagenumber}]
    [{\tfx\bf\pagenumber}\hfill]
    []

\setuphead
  [section, subject]
  [
    page=no,
    style={\bfc},
    before={\blank[2*big]},
    after=\blank,
    color=maincolor,
    sectionsegments=3:3,
  ]    

\stopsectionblockenvironment


%------------------------------------------------------------------------------

\startsectionblockenvironment[appendix]

\setuphead[part][header=empty,footer=empty,number=no]

\setuphead
    [chapter]
    [after={\strut\blank[3*big]},
     header=empty,footer=empty]

\setupfootertexts[text]                                                 % sides
    [{\tfx\labeltext{appendix} \getmarking[chapternumber]}]
    [{\framed[height=max,
             frame=off,
             offset=0pt,
              width=0.4\textwidth,
             location=top,
             strut=yes,
             align={high,flushright}]
     {\tfx\cap{\getmarking[chapter]}}}]
    [{\framed[height=max,
              frame=off,
              offset=0pt,
              width=0.4\textwidth,
             strut=yes,
              location=top,
              align={high,flushleft}]
     {\tfx\cap{\getmarking[chapter]}}}]
    [{\tfx\labeltext{appendix} \getmarking[chapternumber]}]

\setupfootertexts[margin]                                                 % sides
    []
    [\hfill{\tfx\bf\pagenumber}]
    [{\tfx\bf\pagenumber}\hfill]
    []

\setuphead  [chapter, title]                [sectionsegments=2:2]
\setuphead  [section, subject]              [sectionsegments=2:3]
\setuphead  [subsection, subsubject]        [sectionsegments=2:4]
\setuphead  [subsubsection, subsubsubject]  [sectionsegments=2:5]

\stopsectionblockenvironment


%------------------------------------------------------------------------------

\startsectionblockenvironment[backpart]

\setupfootertexts[text]    [][][][]
\setupfootertexts[margin]  [][][][]
\setupbottomtexts[text]    [][][][]

\stopsectionblockenvironment